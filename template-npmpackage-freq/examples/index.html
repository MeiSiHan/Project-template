<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv=Content-Type content="text/html;charset=utf-8">
  <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
  <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="js/qwebchannel.js"></script>

  <title>freq chart</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      /* 禁止触摸屏上的缩放 */
    }

    #mycanvas {
      margin: 0;
      width: 100%;
      height: 100px;
      position: relative;
    }
    #bottomBox{
      position: absolute;
      left: 0px;
      bottom: 50px;
      height: auto;
      width: auto;
      z-index: 1000;
    }
    #bottomBox .button{
      width: 40px;
      height: 40px;
      border: 1px solid #ddd;
      margin: 4px;
      cursor: pointer;
      border-radius: 6px;
      background-color: rgba(0, 60, 136, 0.6);
    }
    #bottomBox .button:first-child{
      margin-bottom: 20px;
    }
    #bottomBox .button:hover{
      background-color: #aaa;
    }
    #consolelogs {
      height: 200px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <div id="mycanvas" style="color: rebeccapurple;">
    <div id="bottomBox">
      <div id="zoom_in" class="button"></div>
      <div id="zoom_out" class="button"></div>
    </div>
  </div>
  <button onclick="onloadpageclick()">加载页面</button>
  <button id="onloadclick" onclick="window.location.reload()">刷新页面</button>
  <button id="onloadclick" onclick="cleartext()">清空</button>
  <div id="consolelogs"></div>
  <!-- 引入你的编译库 -->

  <script src="./dist/freqChart.js"></script>
  <script src="../dist/freqChart.js"></script>
  <!-- <script src="../dist/freqChart.cjs.js"></script> -->
  <!-- <script src="../dist/freqChart.esm.js"></script> -->
  <!-- <script src="../lib/freqChart.js"></script> -->
  <script>
    var freqCharts = ""
    // window.onload = function() {
    var options = {
      "background": "#fff",
      "type": "FFT", //FFT DScan
      "width": '100%', //画布宽度
      "height": '100%', //画布高度
      "center_freq": 200000000,
      "span": 2000000,
      "grid": {
        "width": 1,
        "color": "#B7B7B7",
        "top": 60,
        "left": 50,
        "right": 5,
        "xgrid_line_dash": [15, 5]
      },
      "xaxis": {
        "width": 1,
        "unit": "MHz",
        "decimals": 4,
        "color": "#333"
      }
    }
    var tree_data = {
      "table_name": "中国",
      "format_type": 1,
      "business_list": [{
          "business_id": 1,
          "color": "#00FFFF",
          "language": [{
              "code": 2052,
              "name": "固定"
            },
            {
              "code": 1033,
              "name": "Fixed"
            }
          ]
        },
        {
          "business_id": 2,
          "color": "#FFE4C4",
          "language": [{
              "code": 2052,
              "name": "移动"
            },
            {
              "code": 1033,
              "name": "Mobile"
            }
          ]
        },
        {
          "business_id": 3,
          "color": "#8A2BE2",
          "language": [{
              "code": 2052,
              "name": "无线电定位"
            },
            {
              "code": 1033,
              "name": "Radiolocation"
            }
          ]
        },
        {
          "business_id": 4,
          "color": "#FF7F50",
          "language": [{
              "code": 2052,
              "name": "水上移动"
            },
            {
              "code": 1033,
              "name": "Maritime Mobile"
            }
          ]
        },
        {
          "business_id": 5,
          "color": "#006400",
          "language": [{
              "code": 2052,
              "name": "广播"
            },
            {
              "code": 1033,
              "name": "Broadcasting"
            }
          ]
        }
      ],
      "band_list": [{
          "start_freq": 2190500,
          "end_freq": 2193000,
          "business": [{
            "business_id": 4
          }]
        },
        {
          "start_freq": 2193000,
          "end_freq": 2300000,
          "business": [{
              "business_id": 1
            },
            {
              "business_id": 2
            },
            {
              "business_id": 3
            }
          ]
        },
        {
          "start_freq": 2300000,
          "end_freq": 2453000,
          "foot_notes": ["CHN4"],
          "business": [{
              "business_id": 1
            },
            {
              "business_id": 2
            },
            {
              "business_id": 5,
              "foot_note": ["5.113"],
              "extend_band": [
                [{
                    "start_freq": 2300000,
                    "end_freq": 2310000,
                    "note": ["note0001"]
                  },
                  {
                    "start_freq": 2310000,
                    "end_freq": 2320000,
                    "note": ["note0001"]
                  }
                ],
                [{
                    "start_freq": 2300000,
                    "end_freq": 2350000,
                    "note": ["note0002"]
                  },
                  {
                    "start_freq": 2350000,
                    "end_freq": 2400000,
                    "note": ["note0002"]
                  }
                ]
              ]
            }
          ]
        },
        {
          "start_freq": 2453000,
          "end_freq": 2495000,
          "business": [{
            "business_id": 1
          }]
        },
      ],
      "notes_list": [{
          "note_id": "5.113",
          "language": [{
              "code": 2052,
              "content": "广播业务使用 2300-2495kHz（1 区为 2498kHz），3200-3400kHz，4750-4995kHz和 5005-5060kHz 频段的条件见 5.16 至 5.20，5.21 和 23.3 至 23.10 款。"
            },
            {
              "code": 1033,
              "content": "xxxxxxxxxxxx"
            }
          ]
        },
        {
          "note_id": "CHN4",
          "language": [{
              "code": 2052,
              "content": "该频段可有限制地用于无线电定位业务，不得对其他业务产生有害干扰。（2001 年）"
            },
            {
              "code": 1033,
              "content": "xxxxxxxxxxxx"
            }
          ]
        },
        {
          "note_id": "note0001",
          "language": [{
              "code": 2052,
              "content": "xxxxxxx"
            },
            {
              "code": 1033,
              "content": "xxxxxxxxxxxx"
            }
          ]
        },
        {
          "note_id": "note0002",
          "language": [{
              "code": 2052,
              "content": "xxxxxxx"
            },
            {
              "code": 1033,
              "content": "xxxxxxxxxxxx"
            }
          ]
        }
      ]
    }
    
    
    // 创建多个元素的HTML字符串
    var htmlContent = '';

    // 使用innerHTML添加多个元素

    // 使用innerHTML添加多个元素
    document.getElementById("consolelogs").innerHTML += htmlContent;
    // };
    function showconsole(data) {
      var nowdragtimes = new Date().getTime()
      var reqdata = JSON.stringify(data)
      var texts = '<p><span>' + nowdragtimes + '</span>' + reqdata + '</p>'
      // $("#consolelogs").append(texts)
      document.getElementById("consolelogs").innerHTML += texts
    }
    window.addEventListener('error', function (errorMessage, scriptURI, lineNo, columnNo, error) {
      var texts = "message:" + errorMessage.message + ",line:" + errorMessage.lineno + ",filename:" + errorMessage
        .filename + ",error" + JSON.stringify(errorMessage)
      var reqdata = '{"callback_type":"map_log报错","name":"代码报错报错报错","callback_data":' + texts + '}';
      showconsole(reqdata)
    }, true);

    function cleartext() {
      document.getElementById("consolelogs").innerHTML = '';
    }
    //功能方法
    function startmethod(data){
      var types=data.operate_type;
      
      if(types== "load_chart"){
        onloadPage(data)
      }
    }

    onloadpageclick()
    function onloadpageclick() {
      console.log("加载")
      var data = {
        "operate_type": "load_chart",
        "operate_data": {
          "data_options": {
            "language_code": 2052, //语言代码 2052中文 1033英文
            "background": [255,255,255,1], //背景色
            "height":100,
            "grid": { //网格样式
              "left": 50, //左边距
              "right": 5, //右边距
              "stroke_color": [51,51,51,1], //网格线颜色
              "stroke_width": 1, //网格线宽度
              "stroke_focus_width": 2, //网格线焦点宽度
              "stroke_focus_color": [250,0,0,1], //网格线焦点颜色
            },
            "x_axis": { //X轴样式
              "decimals": "", //X轴刻度标签小数位数
              "unit": "", //单位MHz 为空不显示 
            },
            "lock": {//锁屏样式
              "content": "测试",
              "font_size": 40, //图标字体大小
              "color": [255, 255, 255, 1], //字体颜色
              "background": [0, 60, 136, 0.5] //背景颜色
            }
          },
          "data_chart": tree_data
        }

      }
      startmethod(data)

    
    }
    function onloadPage(data){
      var options=data.operate_data.data_options
      var tree_datas=data.operate_data.data_chart
      freqCharts = new freqChart("mycanvas", options, tree_datas);
      freqCharts.onClick(function (data) {
        console.log("控件点击事件",data)
      })
      freqCharts.onFreq(function (min,max) {
        console.log("频率改变事件",min,max)
      })
      freqCharts.onKey(function (data) {
          console.log("频率按键消息",data)
      })
    }
    function updateOptions(){
      var data={
        "operate_type": "update_options",
        "operate_data": {
          "data_options": {
            "language_code": "2052", //语言代码 2052中文 1033英文
            "type": "1", //图表类型 1 2
            "background": "#fff", //背景色
            "grid": { //网格样式
              "left": 50, //左边距
              "top": 60, //上边距
              "bottom": 40, //下边距
              "right": 5, //右边距
              "stroke_color": [51,51,51,1], //网格线颜色
              "stroke_width": 1, //网格线宽度
              "stroke_focus_width": 2, //网格线焦点宽度
              "stroke_focus_color": [250,0,0,0], //网格线焦点颜色
            },
            "x_axis": { //X轴样式
              "decimals": 0, //X轴刻度标签小数位数
              "unit": "", //单位MHz 为空不显示 
            },
            "lock": {//锁屏样式
              "content": "测试",
              "font_size": 40, //图标字体大小
              "color": [255, 255, 255, 1], //字体颜色
              "background": [0, 60, 136, 0.5] //背景颜色
            }
          }
        }
      }
    }
    function updatadata(data) {
      var data = {
        "operate_type": "updata_chart", //操作类型
        "operate_data": {
          "data_chart": tree_data
        }
      }
    }

    function setFreqRange() {
      var data = {
        "operate_type": "set_freq_range",
        "operate_data": {
          "data_freqs": {
            "start": 1000,
            "end": 2000
          }
        }
      }
    }
    //锁屏
    function setlock() {
      var data = {
        "operate_type": "set_lock",
        "operate_data": {
          "lock_status": true, //锁定状态遮罩
        }
      }
    }

    function outlock() {
      var data = {
        "operate_type": "set_lock",
        "operate_data": {
          "lock_status": false
        }
      }
    }
    function setKey(){
      var ddd={
        "operate_type": "set_key",
        "operate_data": {
          "data_key":{
              "type":"4",//0 上 1下 2左 3右 4确认 5返回 6清除控制模式
              "action":0,//0 单击1双击2长按3释放
          }  
        }
      }
    }




    //  new QWebChannel(qt.webChannelTransport, function(channel) {
    //      window.bridge = channel.objects.bridge;
    //      //bridge.recvDataFromWebFun('{"callback_type":"get_chart"}')
    //  })

    function setkeyMessage() {
      //chart 图表控件 grid 频率网格 “” 空表示没有焦点
      var message = '{"callback_type":"set_key","callback_data":{"key_type":"chart"}}'
      //bridge.recvDataFromWebFun(message)
    }

    function freqMessage() {
      var message = '{"callback_type":"freq_change","callback_data":{"start_freq":100,"end_freq":200}}'
      //bridge.recvDataFromWebFun(message)
    }

    function gridClickMessage() {
      var message =
        '{"callback_type":"click_grid","callback_data":{"data_type":"grid_chart","business_id": 5,"name": "广播","foot_note": ["5.113"]}}'
      //bridge.recvDataFromWebFun(message)
    }
    function buttonClickMessage() {
      //1放大 2缩小
      var message =
        '{"callback_type":"click_scale_button","callback_data":{"data_type":"button","scale_value": 1}}'
      //bridge.recvDataFromWebFun(message)
    }
    

  </script>

</body>

</html>