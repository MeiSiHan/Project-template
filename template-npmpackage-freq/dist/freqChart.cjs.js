"use strict";function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,o(e.key),e)}}function i(t,i,s){return(i=o(i))in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}function s(t,i){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);i&&(e=e.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),s.push.apply(s,e)}return s}function e(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?s(Object(o),!0).forEach((function(s){i(t,s,o[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(o,i))}))}return t}function o(t){var i=function(t,i){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var e=s.call(t,i||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function h(t,i){for(var s in i)i.hasOwnProperty(s)&&("object"!==n(i[s])||null===i[s]||Array.isArray(i[s])||Array.isArray(t[s])?t[s]=i[s]:(t[s]||(t[s]={}),h(t[s],i[s])));return t}function a(t,i,s){if(isNaN(t)||isNaN(i))return"";if(""===i)return t;i=Math.max(0,Math.floor(i));var e=Math.pow(10,i),o=Math.trunc(t*e)/e;return s?parseFloat(o.toFixed(i)):o.toFixed(i)}function r(t){return"rgba(".concat(t[0],",").concat(t[1],",").concat(t[2],",").concat(t[3],")")}function l(t,i){return t.every((function(t){return t.end_freq<=i.start_freq||t.start_freq>=i.end_freq}))}var c=function(){return i=function t(i,s,e){var o=this;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this._isMyClassInstance=!0,this.devicePixelRatio=1,this.box=document.getElementById(i);for(var n=document.querySelectorAll("canvas"),h=0;h<n.length;h++)n[h].remove();this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.box.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!0,this.bottomBox=document.getElementById("bottomBox"),this.bottomBox.style.display="flex",this.lockBox=document.getElementById("lock_mask"),this.loadMask=document.getElementById("onload_mask"),this.scrollBar=document.getElementById("scroll-bar"),this.scrollBarContent=document.getElementById("scroll-bar-content"),this.scrollBar.style.display="none",this.gridbackground="#fff",this.treeData=[],this.onFreqChangeCallback=null,this.callbackFreq={min:0,max:0},this.onClickGridCallback=null,this.onKeyCallback=null,this.onClickZommCallback=null,this.onFocusCallback=null,this.onSwitchCallback=null,this.zoomStatus=1,this.chartWidth=0,this.chartHeight=0,this.xLabelGridInfo=[],this.inittreeData={},this.wifiMaxrows=0,this.freqPxStep=0,this.freqXDiff=0,this.initDefault(),this.initOptions(s),e&&this.readJsonData(e),this.canvas.addEventListener("mousedown",this.mousedown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseup.bind(this)),this.canvas.addEventListener("mousemove",this.throttle(this.mousemove.bind(this),50)),this.canvas.addEventListener("mouseout",this.mouseout.bind(this)),this.canvas.addEventListener("touchstart",this.touchstart.bind(this)),this.canvas.addEventListener("touchmove",this.throttle(this.touchmove.bind(this),50)),this.canvas.addEventListener("touchend",this.touchend.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this)),this.canvas.addEventListener("dblclick",this.handleDblClick.bind(this)),this.canvas.addEventListener("click",this.handleClick.bind(this)),document.getElementById("zoom_in").addEventListener("click",(function(t){o.showconsole("点击缩放了"),t.preventDefault(),o.setZomm(o.zoomStatus,t)})),document.getElementById("switch_button").addEventListener("click",(function(t){t.preventDefault(),o.showconsole("点击切换按钮"),o.setSwitch(t)})),this.canvas.addEventListener("contextmenu",this.handleContextMenu.bind(this)),window.addEventListener("keydown",this.handleKeydown.bind(this)),window.addEventListener("keyup",this.handleKeyup.bind(this)),window.addEventListener("resize",(function(){return o.resizeCanvas()})),this.scrollBar.addEventListener("scroll",this.handleScroll.bind(this)),this.scrollBar.addEventListener("mousedown",this.mousedownScroll.bind(this)),this.scrollBar.addEventListener("touchstart",this.mousedownScroll.bind(this)),this.scrollBar.addEventListener("mousemove",this.mousemoveScroll.bind(this)),this.scrollBar.addEventListener("touchmove",this.mousemoveScroll.bind(this)),this.scrollBar.addEventListener("mouseup",this.mouseupScroll.bind(this)),this.scrollBar.addEventListener("touchend",this.mouseupScroll.bind(this));for(var a=document.querySelectorAll(".active"),r=0;r<a.length;r++)a[r].classList.remove("active");var l=[];if(this.options.button.show_zoom_button&&l.push({type:"button",key:"zoomin",column:0,row:0}),this.options.button.show_switch_button){var c=l.length;l.push({type:"button",key:"switch",column:0,row:c})}this.focusInfo={isLock:!1,focus:null,prefocus:null,list:[l]},this.mousedownInfo={isMouseDown:!1,startX:0,startY:0,mouseupx:0,mouseupy:0,button:0},this.moveInfo={isMove:!1,preX:0,preY:0,moveX:0,moveY:0},this.scrollBarInfo={isMove:!1},this.drawChart()},s=[{key:"initDefault",value:function(){this.isDraw=!0,this.isDragging=!1,this.isZooming=!1,this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.scaleDirection="x",this.selectedArea=null,this.touchStartDist=0,this.touchStartInfo={start_freq:0,end_freq:0,touch_center_freq:0},this.prevTouchDistance=0,this.isTouching=!1,this.touchStartX=0,this.touchStartY=0,this.isTouchDragging=!1,this.lastTouchDistance=0,this.lastTouchCenterX=0,this.focusType=""}},{key:"setCanvasSize",value:function(t,i){var s=t||this.options.width,e=i||this.options.height,o=this.box.clientWidth||400,n=this.box.clientHeight||300;this.canvas.width="100%"===s?o:s,this.canvas.height="100%"===e?n:e,this.canvas.style.width="".concat("100%"===s?o:s,"px"),this.canvas.style.height="".concat("100%"===e?n:e,"px"),this.width=this.canvas.width,this.height=this.canvas.height,this.chartWidth=Math.floor(this.width-this.options.grid.left-this.options.grid.right),this.chartHeight=Math.floor(this.height-this.options.grid.top-this.options.grid.bottom),this.options.grid.right=this.width-this.options.grid.left-this.chartWidth,this.options.grid.bottom=this.height-this.options.grid.top-this.chartHeight,document.getElementById("bottomBox").style.height=this.height+"px",document.getElementById("bottomBox").style.width=this.options.grid.left+"px",this.scrollBar.style.top=this.options.grid.top+"px",this.scrollBar.style.right=this.options.grid.right+"px",this.scrollBar.style.height=this.chartHeight+"px"}},{key:"initOptions",value:function(t,i){var s=h({},{type:1,width:"100%",height:"100%",isPrint:!1,background:"#fff",language_code:2052,isreadfile:!1,channel_show:"auto",scrollbar_show:"auto",grid:{left:50,top:40,bottom:50,right:5,track_gap:0,track_title_height:30,track_min_height:30,channel_max_height:30,track_grid_min_width:30,stroke_color:[51,51,51,1],stroke_width:1,stroke_focus_width:2,stroke_focus_color:[255,0,0,1],width:1,background:[255,255,255,1]},x_axis:{decimals:"",unit:"",unit_right:10,unit_position:"top",show_top_label:!1,show_bottom_label:!1,init_start_freq:1e7,init_end_freq:2e9,start_freq:1e7,end_freq:2e9,text_color:[51,51,51,1],text_font_size:12,text_font_family:"Arial",color:"#333",width:1,item_min_width:10,labels:[]},button:{show_zoom_button:!0,background_button:[252,176,64,1],show_switch_button:!0},lock:{content:"",font_size:40,color:[255,255,255,1],background:[0,60,136,.5]},label_angle:90,tree_data:{}});this.options=h(s,t),this.options.grid.left=Math.floor(this.options.grid.left*this.devicePixelRatio),this.options.x_axis.show_bottom_label?this.options.grid.bottom=Math.floor(this.options.grid.bottom*this.devicePixelRatio):this.options.grid.bottom=0,this.options.x_axis.show_top_label?this.options.grid.top=Math.floor(this.options.grid.top*this.devicePixelRatio):this.options.grid.top=0,this.options.grid.right=Math.floor(this.options.grid.right*this.devicePixelRatio);for(var e=this.bottomBox.getElementsByClassName("button"),o=0;o<e.length;o++)e[o].style.flex="1",e[o].style.backgroundColor=r(this.options.button.background_button);this.zoomBox=document.getElementById("zoom_in"),this.options.button.show_zoom_button&&(this.zoomBox.style.display="flex"),this.options.button.show_switch_button&&(this.switchBox=document.getElementById("switch_button"),this.switchBox.style.display="flex"),"update"!==i&&(this.options.x_axis.start_freq=this.options.x_axis.init_start_freq,this.options.x_axis.end_freq=this.options.x_axis.init_end_freq),this.xLabelGridInfo=[],this.setCanvasSize()}},{key:"readJsonData",value:function(t){if(!t)return!1;this.inittreeData=t,this.options.type=t.format_type||this.options.type,this.gridbackground=t.bg_color||"#fff"}},{key:"initData",value:function(t){var i=JSON.parse(JSON.stringify(t.band_list));performance.now();var s=[];if(1==this.options.type){var e=this.getRegionData(i,this.options.x_axis.start_freq,this.options.x_axis.end_freq);s=this.calculateItemData(e),e=null}else{var o=this.getRegionData(i,this.options.x_axis.init_start_freq,this.options.x_axis.init_end_freq);2==this.options.type&&this.getMaxRowNum(o);for(var n=this.layoutEvents(o),h=[],a=0;a<n.length;a++)h.push([n[a]]);s=this.initCulateItemData(h),o=null,h=null}this.initFocusList(s,this.options.type),this.treeData.length=0,this.treeData=s,i=null,s=null}},{key:"getRegionData",value:function(t,i,s){for(var e=[],o=0;o<t.length;o++){var n=t[o],h=n.start_freq,a=n.end_freq;if(!(a<i))if(a>=i&&h<=s)e.push(n);else if(h>s)continue}return e}},{key:"getMaxRowNum",value:function(t){for(var i=0,s=0;s<t.length;s++){var e=t[s];e.child_band&&e.child_band.length>i&&(i=e.child_band.length)}this.wifiMaxrows=i}},{key:"initFocusList",value:function(t,i){var s=this;this.focusInfo.list.splice(1);for(var e=[],o=0;o<t.length;o++){var n=t[o],h=[],a=[];a=1==i?n.business:n;for(var r=0;r<a.length;r++){var l=a[r],c={};1==i?(c={direction:"vertical",type:"grid",key:l.orderid,column:o+1,row:r},h.push(c)):(c={direction:"horizontal",type:"grid",key:l.orderid,column:r+1,row:o},h.push(c)),this.focusInfo.focus&&this.focusInfo.focus.type==l.orderid&&(this.focusInfo.focus=c)}1==i?this.focusInfo.list.push(h):e.push(h)}if(1!==i){for(var f=0,u=0;u<e.length;u++)e[u].length>f&&(f=e[u].length);for(var d=[],_=0;_<f;_++){for(var x=[],p=0;p<e.length;p++)void 0!==e[p][_]&&x.push(e[p][_]);x.length>0&&d.push(x)}d.forEach((function(t,i){s.focusInfo.list.push(t)}))}e=null}},{key:"calculateItemData",value:function(t){var i=this.chartWidth,s=this.options.x_axis.end_freq-this.options.x_axis.start_freq,e=i/s;this.freqPxStep=s/i,this.freqXDiff=s;for(var o=[],n=0;n<t.length;n++){var h=t[n],a=h.start_freq,r=h.end_freq,l=(a-this.options.x_axis.start_freq)*e,c=(r-this.options.x_axis.start_freq)*e,f=c-l,u=a;h.type="column",h.column_id=n,a<this.options.x_axis.start_freq&&r>=this.options.x_axis.start_freq&&r<=this.options.x_axis.end_freq?(f=c-(l=0),u=this.options.x_axis.start_freq):a<=this.options.x_axis.end_freq&&a>=this.options.x_axis.start_freq&&r>this.options.x_axis.end_freq?(f=(c=(this.options.x_axis.end_freq-this.options.x_axis.start_freq)*e)-l,this.options.x_axis.end_freq):a<this.options.x_axis.start_freq&&r>this.options.x_axis.end_freq&&(l=0,f=(c=(this.options.x_axis.end_freq-this.options.x_axis.start_freq)*e)-l,u=this.options.x_axis.start_freq,this.options.x_axis.end_freq),h.start_x=l,h.label_start_x=l,h.label_start_freq=u,h.label_end_x=c,h.label_end_freq=u,h.width=f,h.height=this.chartHeight*this.scaleY,h.end_x=c;for(var d=h.business,_=this.chartHeight*this.scaleY/d.length,x=0;x<d.length;x++){var p=d[x];p.type="item",p.orderid=n+"_"+x,p.column_id=n,p.item_id=x,p.width=f,p.height=_,p.start_freq=a,p.end_freq=r,p.start_x=l,p.end_x=c,p.parent_foot_notes=h.foot_notes,p.x=p.start_x+this.offsetX+this.options.grid.left,p.y=this.options.grid.top+_*x+this.offsetY,p.color=this.getItemColor(p.business_id),p.text=[this.getItemText(p.business_id)]}o.push(h)}return o}},{key:"initCulateItemData",value:function(t,i){var s=this,e=this.chartWidth,o=this.options.x_axis.end_freq-this.options.x_axis.start_freq,n=e/o;this.freqPxStep=o/e,this.freqXDiff=o;var h=[],a=this.options.grid.track_gap||0,r=(this.chartHeight-(t.length-1)*a)/t.length;if("childwifi"==i){a=0;var l=this.wifiMaxrows||t.length;r=(this.chartHeight-(l-1)*a)/(l+1)}var c=r*this.scaleY,f=0;"childwifi"==i&&(c>this.options.grid.channel_max_height&&(c=this.options.grid.channel_max_height),f=c,this.options.grid.track_title_height=f);for(var u=0;u<t.length;u++){var d=t[u];"childwifi"==i&&(d=[t[u].child_band_ranges]);for(var _=0;_<d.length;_++){for(var x,p=d[_],g=[],v=function(){var e=p[y];null!=e.sub_title&&(e.sub_title_height=f);var o=e.start_freq,h=e.end_freq,r=(o-s.options.x_axis.start_freq)*n,l=(h-s.options.x_axis.start_freq)*n,d=l-r,_=o,v=h;if(o<s.options.x_axis.start_freq&&h>=s.options.x_axis.start_freq&&h<=s.options.x_axis.end_freq?(d=l-(r=0),_=s.options.x_axis.start_freq):o<=s.options.x_axis.end_freq&&o>=s.options.x_axis.start_freq&&h>s.options.x_axis.end_freq?(d=(l=(s.options.x_axis.end_freq-s.options.x_axis.start_freq)*n)-r,v=s.options.x_axis.end_freq):o<s.options.x_axis.start_freq&&h>s.options.x_axis.end_freq&&(r=0,d=(l=(s.options.x_axis.end_freq-s.options.x_axis.start_freq)*n)-r,_=s.options.x_axis.start_freq,v=s.options.x_axis.end_freq),e.type="item",e.column_id=y+1,e.orderid=e.column_id+"_"+u,"childwifi"==i&&(e.childtype="childband",e.parent_orderid=t[u].parent_orderid,e.parent_foot_notes=t[u].parent_foot_notes,e.orderid=t[u].parent_orderid+"_"+e.orderid),e.item_id=u,e.label_start_x=r,e.label_start_freq=_,e.label_end_x=l,e.label_end_freq=v,e.width=d,e.height=c,e.start_x=r,e.end_x=l,e.x=e.start_x+s.offsetX+s.options.grid.left,e.y=s.options.grid.top+(c+a)*u+s.offsetY+f,3==s.options.type?(e.color=e.color,x="",e.language.forEach((function(t){t.code==s.options.language_code&&(x=t.name)})),e.text=[x]):"childwifi"==i?(e.color=t[u].color,e.text=[e.business_name]):(e.color=s.getItemColor(e.business_id),e.text=[s.getItemText(e.business_id)],null!=e.sub_title&&e.text.push(e.sub_title)),2==s.options.type&&e.child_band){var m=e.child_band;m.forEach((function(t){t.x=e.x,t.y=e.y,t.width=e.width,t.height=c,t.start_x=e.start_x,t.end_x=e.end_x,t.parent_orderid=e.orderid,t.parent_foot_notes=e.foot_notes,t.child_band_ranges=s.getRegionData(t.child_band_range,s.options.x_axis.start_freq,s.options.x_axis.end_freq)})),e.child_business_list=s.initCulateItemData(m,"childwifi")}g.push(e)},y=0;y<p.length;y++)v();h.push(g)}}return h}},{key:"drawCharts",value:function(){this.setLoadMask(!0);var t=performance.now();this.clearCanvas(),this.initBackground(),this.initData(this.inittreeData),this.showconsole("数据处理总时长: "+(performance.now()-t).toFixed(3)+"ms"),this.drawAxis(),this.drawGrid(),this.showconsole("绘制总时长: "+(performance.now()-t).toFixed(3)+"ms"),this.setLoadMask(!1),this.updateScrollbar()}},{key:"drawChart",value:function(){this.debounce(this.drawCharts(),500)}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"initBackground",value:function(){this.ctx.fillStyle=this.gridbackground,this.ctx.fillRect(0,0,this.width,this.height)}},{key:"drawAxis",value:function(){var t=this;if(this.initdrawData(),this.selcetedFocus(),this.ctx.strokeStyle=r(this.options.x_axis.color),this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(this.options.grid.left,this.height-this.options.grid.bottom),this.ctx.lineTo(this.width-this.options.grid.right,this.height-this.options.grid.bottom),this.ctx.stroke(),this.ctx.fillStyle=r(this.options.x_axis.text_color),this.ctx.textBaseline="top",this.ctx.font="".concat(this.options.x_axis.text_font_size*this.devicePixelRatio,"px ").concat(this.options.x_axis.text_font_family),this.options.x_axis.show_bottom_label&&this.options.x_axis.labels.forEach((function(i,s){var e=0,o=t.height-t.options.grid.bottom+8,n=a(i.text/1e6,t.options.x_axis.decimals);e=0==s?t.options.grid.left:t.width-t.options.grid.right-t.ctx.measureText(n).width,t.ctx.fillText(n,e,o)})),""!==this.options.x_axis.unit){var i,s=this.width-this.options.grid.right-this.options.x_axis.unit_right-this.ctx.measureText(this.options.x_axis.unit).width;i="top"===this.options.x_axis.unit_position?this.options.grid.top-this.options.x_axis.text_font_size-14:this.height-this.options.grid.bottom+this.options.x_axis.text_font_size+8,this.ctx.fillText(this.options.x_axis.unit,s+8,i)}if(this.options.x_axis.show_top_label)for(var e=this.treeData,o=0;o<e.length;o++){var n=e[o];Array.isArray(n)||(1==e.length?(this.drawItemText(n.label_start_freq,n.label_start_x+this.options.grid.left,this.options.grid.top-14),this.drawItemText(n.label_end_freq,n.label_end_x+this.options.grid.left-10,this.options.grid.top-14)):e.length>1&&(0==o||o<e.length-1?this.drawItemText(n.label_start_freq,n.label_start_x+this.options.grid.left,this.options.grid.top-14):o==e.length-1&&(this.drawItemText(n.label_start_freq,n.label_start_x+this.options.grid.left,this.options.grid.top-14),this.drawItemText(n.label_end_freq,n.label_end_x+this.options.grid.left-30,this.options.grid.top-14))))}}},{key:"initdrawData",value:function(){var t=[{offsetx:0,text:this.options.x_axis.start_freq},{offsetx:this.chartWidth+this.options.grid.left,text:this.options.x_axis.end_freq}];this.options.x_axis.labels=t}},{key:"drawGrid",value:function(){this.ctx.fillStyle=this.gridbackground,this.ctx.fillRect(this.options.grid.left,this.options.grid.top,this.chartWidth,this.chartHeight),this.ctx.strokeStyle=r(this.options.grid.stroke_color),this.ctx.lineWidth=this.options.grid.stroke_width,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(this.options.grid.left,this.options.grid.top,this.chartWidth,this.chartHeight),this.ctx.clip(),this.ctx.beginPath();var t=this.options.grid.stroke_width||2;this.ctx.lineWidth=t;for(var i=!1,s=0;s<this.treeData.length;s++){var e=[];e=1!==this.options.type?this.treeData[s]:this.treeData[s].business;for(var o=0;o<e.length;o++){var n=e[o],h=n.x,a=n.y,l=n.width,c=n.height;this.ctx.fillStyle=n.color,this.ctx.fillRect(h,a,l,c),this.ctx.strokeStyle=this.options.grid.stroke_color||"#333",this.ctx.setLineDash([]),this.ctx.lineWidth=t,this.focusInfo.focus&&this.focusInfo.focus.key==n.orderid&&(i=!0,this.selectedArea=n),this.ctx.strokeRect(h+t/2,a+t/2,l-t,c-t),2==this.options.type&&"show"==this.options.channel_show||2==this.options.type&&"auto"==this.options.channel_show&&n.child_business_list&&n.child_business_list.length>0&&c>18&&l>50?(this.drawTree(n.child_business_list),this.drawTexts(n.text,h,a,l,this.options.grid.track_title_height)):this.drawTexts(n.text,h,a,l,c)}}if(this.selectedArea&&i){this.ctx.strokeStyle=r(this.options.grid.stroke_focus_color),this.ctx.setLineDash([]),this.ctx.lineWidth=this.options.grid.stroke_focus_width;var f=this.selectedArea.x,u=this.selectedArea.y,d=this.selectedArea.width,_=this.selectedArea.height;this.ctx.strokeRect(f+.5,u+.5,d-1,_-1)}this.ctx.restore()}},{key:"drawTree",value:function(t){for(var i=0;i<t.length;i++){var s=t[i];if(!(t[i].length<1)){var e=s[t[i].length-1].end_x-s[0].x+this.options.grid.left;this.ctx.fillStyle=s[0].color,this.ctx.fillRect(s[0].x,s[0].y,e,s[0].height),this.ctx.lineWidth=1,this.ctx.strokeStyle="#666",this.ctx.setLineDash([5,5],0),this.ctx.strokeRect(s[0].x+.5,s[0].y+.5,e-1,s[0].height-1);for(var o=0;o<s.length;o++){var n=s[o],h=n.x,a=n.y,r=n.width,l=n.height;this.drawTexts(n.text,h,a,r,l),o>0&&(this.ctx.strokeStyle="#666",this.ctx.beginPath(),this.ctx.moveTo(h,a),this.ctx.lineTo(h,a+l),this.ctx.stroke())}s=null}}}},{key:"drawTrees",value:function(t){for(var i=0;i<t.length;i++){for(var s=t[i],e=0;e<s.length;e++){var o=s[e],n=o.x,h=o.y,a=o.width,r=o.height;this.ctx.fillStyle=o.color,this.ctx.fillRect(n,h,a,r),this.ctx.lineWidth=1,this.ctx.strokeStyle="#666",this.ctx.setLineDash([5,5],0),this.focusInfo.focus&&this.focusInfo.focus.key==o.orderid&&(isHaveselectedArea=!0,this.selectedArea=o),this.ctx.strokeRect(n+.5,h+.5,a-1,r-1),this.drawTexts(o.text,n,h,a,r)}s=null}}},{key:"getItemColor",value:function(t){for(var i=this.inittreeData.business_list,s="#ddd",e=0;e<i.length;e++)if(i[e].business_id==t){s=i[e].color;break}return s}},{key:"getItemText",value:function(t){for(var i=this.inittreeData.business_list,s="",e=0;e<i.length;e++)if(i[e].business_id==t)for(var o=i[e].language,n=0;n<o.length;n++)if(o[n].code==this.options.language_code){s=o[n].name;break}return s}},{key:"drawItemText",value:function(t,i,s){var e=a(t/1e6,"");this.ctx.save(),this.ctx.translate(i,s),this.ctx.textAlign="left",this.ctx.fontSize="10px",this.ctx.textBaseline="top",this.ctx.fillText(e,0,0),this.ctx.restore()}},{key:"drawText",value:function(t,i,s,e,o){var n=16;if(this.ctx.font="16px Arial",this.ctx.fillStyle="black",this.ctx.textAlign="center",this.ctx.textBaseline="middle",e>=this.ctx.measureText(t).width)this.ctx.fillText(t,i+e/2,s+o/2);else{if(o<n)return;if(e>=32)for(var h=19.2,a=Math.floor(o/h),r=s+o/2-(u=this.splitText(t,e,a)).length*h/2+9.6,l=0;l<u.length;l++){var c=u[l];this.ctx.fillText(c,i+e/2,r+l*h)}else{var f=o-10;if(0==(a=Math.floor(f/n))||e<n)return;r=s+o/2-(u=this.splitText(t,n,a)).length*n/2;for(var u,d=0;d<u.length;d++){var _=u[d];this.ctx.fillText(_,i+e/2,r+d*n)}}}}},{key:"splitText",value:function(t,i,s){var e=[],o="";if(null==t||null==t||""==t)return e;for(var n=0;n<t.length;n++){var h=o+t[n];if(this.ctx.measureText(h).width>i?(o.length>0&&e.push(o),o=t[n]):o=h,e.length>=s)break}return o.length>0&&e.push(o),0==s&&e.splice(0),e.length>s&&(e[s-1]=e[s-1].slice(0,-1)+"...",e.splice(s)),e}},{key:"drawTexts",value:function(t,i,s,e,o){var n=this,h=26,a=16;if(o<=14)return!1;if(o<=20?(h=18,a=12):o<26&&(h=20,a=14),o<h||e<30||!t instanceof Array)return!1;this.ctx.font=a+"px Arial",this.ctx.fillStyle="black",this.ctx.textAlign="center",this.ctx.textBaseline="middle";var r=[],l=0;if(t.forEach((function(t){for(var i=t.split(""),s="";i.length>0;){var a=i.shift(),c=s+a;if(n.ctx.measureText(c).width+6<=e&&e>32)s=c;else if(r.push(s),s=a,(l+=h)+h>o)break}s&&r.push(s),l+=h})),l>o){var c=Math.floor(o/h);r.splice(c),r.length>=c&&c>0&&(r[c-1]=r[c-1].slice(0,-1)+"...")}if(r.length>0){var f=s+o/2-(r.length-1)*h/2,u=i+(e+4)/2;r.forEach((function(t,i){n.ctx.fillText(t,u,f+i*h)}))}}},{key:"onloadData",value:function(t){this.inittreeData=t,this.drawChart(t)}},{key:"touchstart",value:function(t){if(this.isDragging=!1,1==t.touches.length)this.isTouchDragging=!0,this.touchStartX=t.touches[0].clientX-this.offsetX,this.touchStartY=t.touches[0].clientY;else if(2==t.touches.length){this.isTouching=!0;var i=t.touches[0],s=t.touches[1];this.touchStartInfo={start_freq:this.options.x_axis.start_freq,end_freq:this.options.x_axis.end_freq,touch_center_freq:this.getTouchMouseVal(t).x},this.showconsole(this.touchStartInfo),this.touchStartDist=this.getDistance(i,s),this.prevTouchDistance=this.touchStartDist,this.lastTouchCenterX=(t.touches[0].clientX+t.touches[1].clientX)/2}}},{key:"touchmove",value:function(t){if(this.isDragging=!0,1==t.touches.length&&this.isTouchDragging){if(Math.abs(this.touchStartX-t.touches[0].clientX)>Math.abs(t.touches[0].clientY-this.touchStartY)?this.scaleDirection="x":this.scaleDirection="y","x"===this.scaleDirection){var i=this.touchStartX-t.touches[0].clientX;this.changeMovex(i,"touchmove"),this.touchStartX=t.touches[0].clientX}else if("y"===this.scaleDirection){var s=t.touches[0].clientY-this.touchStartY;this.changeMovey(s,"touchmove"),this.touchStartY=t.touches[0].clientY}}else if(this.isTouching&&2==t.touches.length){var e=t.touches[0],o=t.touches[1],n=this.getDistance(e,o);this.getAngle(e,o);var h=t.touches[0].pageX-t.touches[1].pageX,a=t.touches[0].pageY-t.touches[1].pageY;Math.abs(h)>Math.abs(a)?this.scaleDirection="x":this.scaleDirection="y";var r=this.scaleX,l=this.scaleY,c=n/this.prevTouchDistance;if("x"===this.scaleDirection||"both"===this.scaleDirection){r=(r*=c).toFixed(1)-0;var f=this.options.x_axis.init_end_freq-this.options.x_axis.init_start_freq;if(f<this.chartWidth)return!1;r<1&&(r=1),r>2e3&&(r=2e3),this.prevTouchDistance=n;var u=this.touchStartInfo.touch_center_freq;this.showconsole("放大中心触摸频率"+u);var d=2*Math.floor(f/r/2),_=Math.floor(u-(u-this.touchStartInfo.start_freq)/(this.touchStartInfo.end_freq-this.touchStartInfo.start_freq)*d),x=Math.floor(_+d);_<=this.options.x_axis.init_start_freq&&x>=this.options.x_axis.init_end_freq&&(_=this.options.x_axis.init_start_freq,x=this.options.x_axis.init_end_freq,r=1),_<this.options.x_axis.init_start_freq&&(_=this.options.x_axis.init_start_freq,x=Math.floor(_+d)),x>this.options.x_axis.init_end_freq&&(x=this.options.x_axis.init_end_freq,_=Math.ceil(x-d)),_>=this.options.x_axis.init_start_freq&&x<=this.options.x_axis.init_end_freq&&(this.options.x_axis.start_freq=_,this.options.x_axis.end_freq=x,this.scaleX=r,this.drawChart())}"y"!==this.scaleDirection&&"both"!==this.scaleDirection||((l=(l*=c).toFixed(1)-0)<1&&(l=1,this.offsetY=0),l>3&&(l=3),this.scaleY=l,this.drawChart())}}},{key:"touchend",value:function(t){t.preventDefault(),this.isDragging&&this.onFreqChangeCallback&&(this.callbackFreq.min===this.options.x_axis.start_freq&&this.callbackFreq.max===this.options.x_axis.end_freq||(this.onFreqChangeCallback(this.options.x_axis.start_freq,this.options.x_axis.end_freq),this.callbackFreq={min:this.options.x_axis.start_freq,max:this.options.x_axis.end_freq})),0==this.isDragging&&this.handleClick(t,"touch"),t.touches.length<2&&(this.isTouchDragging=!1,this.isTouching=!1,this.prevTouchDistance=0)}},{key:"getDistance",value:function(t,i){var s=i.pageX-t.pageX,e=i.pageY-t.pageY;return Math.sqrt(s*s+e*e)}},{key:"getAngle",value:function(t,i){var s=i.pageX-t.pageX,e=i.pageY-t.pageY;return Math.atan2(e,s)*(180/Math.PI)}},{key:"mousedown",value:function(t){this.mousedownInfo={isMouseDown:!0,startX:t.offsetX,startY:t.offsetY,mouseupx:0,mouseupy:0,button:t.button},0===t.button?this.ctx.canvas.style.cursor="grabbing":2===t.button&&(this.ctx.canvas.style.cursor="grab")}},{key:"mouseup",value:function(t){var i={isMouseDown:!1,mouseupx:t.offsetX,mouseupy:t.offsetY,button:t.button};this.mousedownInfo=e(e({},this.mousedownInfo),i),this.ctx.canvas.style.cursor="default"}},{key:"mousemove",value:function(t){if(this.mousedownInfo.isMouseDown){0==this.moveInfo.preX&&(this.moveInfo.preX=this.mousedownInfo.startX,this.moveInfo.preY=this.mousedownInfo.startY);var i=t.offsetX-this.moveInfo.preX,s=this.moveInfo.preY-t.offsetY,e=t.offsetX-this.mousedownInfo.startX,o=t.offsetY-this.mousedownInfo.startY;Math.abs(e)>Math.abs(o)?this.changeMovex(i,"mousemove"):this.changeMovey(s,"mousemove")}this.moveInfo={isMove:!0,preX:t.offsetX,preY:t.offsetY,moveX:t.offsetX,moveY:t.offsetY}}},{key:"changeMovex",value:function(t,i){if(t=t.toFixed(1)-0,1==this.scaleX)return!1;var s=this.freqPxStep*t,e=Math.floor(this.options.x_axis.start_freq+s),o=Math.floor(this.options.x_axis.end_freq+s);e<=this.options.x_axis.init_start_freq&&o>=this.options.x_axis.init_end_freq&&(e=this.options.x_axis.init_start_freq,o=this.options.x_axis.init_end_freq,scaleX=1),e<this.options.x_axis.init_start_freq&&(e=this.options.x_axis.init_start_freq,o=Math.floor(e+this.freqXDiff)),o>this.options.x_axis.init_end_freq&&(o=this.options.x_axis.init_end_freq,e=Math.ceil(o-this.freqXDiff)),e>=this.options.x_axis.init_start_freq&&o<=this.options.x_axis.init_end_freq&&(this.options.x_axis.start_freq=e,this.options.x_axis.end_freq=o,this.drawChart())}},{key:"changeMovey",value:function(t,i){if(t=t.toFixed(1)-0,1==this.scaleY)this.offsetY=0,this.drawChart();else{var s=this.offsetY+t,e=-this.chartHeight*(this.scaleY-1);s<=0&&s>=e?(this.offsetY=s,this.drawChart()):this.offsetY=s>0?0:s<e?e:0}}},{key:"mouseout",value:function(t){t.preventDefault(),this.mousedownInfo.isMouseDown=!1,this.moveInfo={isMove:!1,preX:0,preY:0,moveX:0,moveY:0}}},{key:"handleWheel",value:function(t){t.preventDefault();var i=t.deltaY<0?1:-1;this.handleZoom(t,i)}},{key:"handleDblClick",value:function(t){}},{key:"handleClick",value:function(t,i){"touch"==i&&(t=t.changedTouches[0]);var s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,o=t.clientY-s.top,n=this.checkClick(this.treeData,e,o);if(n){this.selectedArea=n.area;var h=this.getFocusList(n.area);this.changeFocus(h.column,h.row,"grid"),this.onClickGridCallback&&(n.childArea?this.onClickGridCallback(n.childArea.area):this.onClickGridCallback(n.area),this.focusInfo.prefocus=this.focusInfo.focus,this.onFocusCallback&&this.onFocusCallback("")),this.drawChart()}else this.selectedArea=null,this.drawChart()}},{key:"getGridInfo",value:function(t,i){for(var s=null,e=0;e<t.length;e++){var o=[];o=1!==this.options.type?t[e]:t[e].business;for(var n=0;n<o.length;n++){var h=o[n];if(h.orderid==i){s=h;break}}}return s}},{key:"getFocusList",value:function(t){for(var i=t.orderid,s=null,e=this.focusInfo.list,o=0;o<e.length;o++)for(var n=e[o],h=0;h<n.length;h++){var a=n[h];if(a.key==i){s=a;break}}return s}},{key:"checkClick",value:function(t,i,s){for(var e=0;e<t.length;e++){var o=[];o=1!==this.options.type?t[e]:t[e].business;for(var n=0;n<o.length;n++){var h=o[n],a=h.x,r=h.y,l=h.width,c=h.height;if(i>=a&&i<=a+l&&s>=r&&s<=r+c){var f=null;return h.child_business_list&&h.child_business_list.length>0&&(f=this.checkClick(h.child_business_list,i,s)),f?{childArea:f,area:h}:{area:h}}}}}},{key:"handleContextMenu",value:function(t){}},{key:"handleKeydown",value:function(t){"x"===t.key?this.scaleDirection="x":"y"===t.key?this.scaleDirection="y":"b"===t.key&&(this.scaleDirection="both")}},{key:"handleKeyup",value:function(t){switch(t.keyCode){case 37:case 39:break;case 38:case 40:this.options.threshold.is_mouse=!1}}},{key:"handleScroll",value:function(t){t.preventDefault()}},{key:"mousedownScroll",value:function(t){t.preventDefault(),this.scrollBarInfo.isMove=!0}},{key:"mouseupScroll",value:function(t){t.preventDefault(),this.scrollBarInfo.isMove=!1}},{key:"mousemoveScroll",value:function(t){t.preventDefault(),this.offsetY!=-this.scrollBar.scrollTop&&this.setOffsetY(-this.scrollBar.scrollTop)}},{key:"setOffsetY",value:function(t){this.offsetY=t,this.drawChart()}},{key:"updateScrollbar",value:function(){var t=!1;"show"==this.options.scrollbar_show?(this.scrollBar.style.display="block",t=!0):"hide"==this.options.scrollbar_show?this.scrollBar.style.display="none":this.scaleY>1?(this.scrollBar.style.display="block",t=!0):this.scrollBar.style.display="none",t&&(this.scrollBarContent.style.height=this.chartHeight*this.scaleY+"px",this.scrollBarContent.offsetHeight,this.scrollBar.scrollTop=-this.offsetY)}},{key:"resizeCanvas",value:function(){this.setCanvasSize(),this.drawChart()}},{key:"setChartSize",value:function(t,i){t&&i&&(this.options.width=t,this.options.height=i),this.setCanvasSize(t,i),this.drawChart()}},{key:"setZomm",value:function(t,i){i.stopPropagation(),this.focusInfo.focus=this.focusInfo.list[0][0],this.drawChart(),this.onClickZommCallback&&this.onClickZommCallback(t)}},{key:"setSwitch",value:function(t){t.stopPropagation();var i=this.focusInfo.list[0].length-1;this.focusInfo.focus=this.focusInfo.list[0][i],this.focusInfo.prefocus=this.focusInfo.list[0][i],this.drawChart(),this.onSwitchCallback&&(this.onSwitchCallback(),this.onFocusCallback&&this.onFocusCallback(""))}},{key:"handleZoom",value:function(t,i){t.preventDefault();var s=this.getMousePosition(),e=1.1;e=t.deltaY<0?1.1:.9;var o=this.scaleX,n=this.scaleY;if("x"===this.scaleDirection&&"grid"==s||"both"===this.scaleDirection&&"grid"==s){o=(o*=e).toFixed(1)-0;var h=this.options.x_axis.init_end_freq-this.options.x_axis.init_start_freq;if(h<this.chartWidth)return!1;o<.5&&(o=.5),o>2e3&&(o=2e3);var a=this.getMouseVal(t,0).x,r=2*Math.floor(h/o/2),l=Math.floor(a-(a-this.options.x_axis.start_freq)/(this.options.x_axis.end_freq-this.options.x_axis.start_freq)*r),c=Math.floor(l+r);l<=this.options.x_axis.init_start_freq&&c>=this.options.x_axis.init_end_freq&&(l=this.options.x_axis.init_start_freq,c=this.options.x_axis.init_end_freq,o=1),l<this.options.x_axis.init_start_freq&&(l=this.options.x_axis.init_start_freq,c=Math.floor(l+r)),c>this.options.x_axis.init_end_freq&&(c=this.options.x_axis.init_end_freq,l=Math.ceil(c-r)),l>=this.options.x_axis.init_start_freq&&c<=this.options.x_axis.init_end_freq&&(this.options.x_axis.start_freq=l,this.options.x_axis.end_freq=c,this.scaleX=o,this.onFreqChangeCallback&&this.onFreqChangeCallback(l,c),this.drawChart())}("y"===this.scaleDirection&&"grid"==s||"both"===this.scaleDirection&&"grid"==s)&&((n=(n*=e).toFixed(1)-0)<1&&(n=1,this.offsetY=0),n>3&&(n=3),this.scaleY=n,this.drawChart())}},{key:"getMouseVal",value:function(t){var i=this.canvas.getBoundingClientRect(),s=t.clientX-i.left;t.clientY,i.top;var e=null,o=null,n=this.options.x_axis.end_freq-this.options.x_axis.start_freq;return s<this.options.grid.left?(e=this.options.x_axis.start_freq,o=0):s>=this.options.grid.left&&s<=this.width-this.options.grid.left&&(e=this.options.x_axis.start_freq+(s-this.options.grid.left)/this.chartWidth*n,e=Math.floor(e)),{x:e,y:null,order:o}}},{key:"getTouchMouseVal",value:function(t){var i=this.canvas.getBoundingClientRect(),s=(t.touches[0].clientX+t.touches[1].clientX)/2,e=(t.touches[0].clientY,t.touches[1].clientY,s-i.left);i.top;var o=null,n=null,h=this.options.x_axis.end_freq-this.options.x_axis.start_freq;return e<this.options.grid.left?(o=this.options.x_axis.start_freq,n=0):e>=this.options.grid.left&&e<=this.width-this.options.grid.left&&(o=this.options.x_axis.start_freq+(e-this.options.grid.left)/this.chartWidth*h,o=Math.floor(o)),{x:o,y:null,order:n}}},{key:"getMousePoint",value:function(t){var i=this.canvas.getBoundingClientRect();return{pointx:t.clientX-i.left,pointy:t.clientY-i.top}}},{key:"getMousePosition",value:function(t){var i=window.event,s=this.canvas.getBoundingClientRect(),e=i.clientX-s.left,o=i.clientY-s.top,n="";return n=e<0||e>this.width||o<0||o>this.height?null:e<this.options.grid.left?"left":o<this.options.grid.top?"top":e>this.canvas.width-this.options.grid.right?"right":o>this.canvas.height-this.options.grid.bottom?"bottom":"grid",this.focusType=n,n}},{key:"getFreqBussiness",value:function(t){for(var i=this.getRegionData(this.inittreeData.band_list,t.start,t.end),s=[],e=0;e<i.length;e++)if(i[e].business_id)s.push(this.getItemText(i[e].business_id));else if(1==this.options.type&&i[e].business&&i[e].business.length>0)for(var o=0;o<i[e].business.length;o++)s.push(this.getItemText(i[e].business[o].business_id));return this.uniqueChinese(s)}},{key:"uniqueChinese",value:function(t){for(var i=Object.create(null),s=[],e=0;e<t.length;e++){var o=t[e];i[o]||(i[o]=!0,s.push(o))}return s}},{key:"getOptions",value:function(){return this.options}},{key:"onFreq",value:function(t){this.onFreqChangeCallback=t}},{key:"onClick",value:function(t){this.onClickGridCallback=t}},{key:"onKey",value:function(t){this.onKeyCallback=t}},{key:"onClickZoom",value:function(t){this.onClickZommCallback=t}},{key:"onFocus",value:function(t){this.onFocusCallback=t}},{key:"onSwitch",value:function(t){this.onSwitchCallback=t}},{key:"updateOptions",value:function(t){var i=h(this.options,t);this.initOptions(i,"update"),this.drawChart()}},{key:"setChartData",value:function(t){this.initDefault(),this.readJsonData(t),this.drawChart()}},{key:"setInitFreqRange",value:function(t){t.start&&t.end&&(this.initDefault(),this.options.x_axis.init_start_freq=t.start,this.options.x_axis.init_end_freq=t.end,this.options.x_axis.start_freq=t.start,this.options.x_axis.end_freq=t.end,this.drawChart())}},{key:"setfreqRange",value:function(t){if(t.start&&t.end){var i=t.start,s=t.end;i==this.options.x_axis.init_start_freq&&s==this.options.x_axis.init_end_freq&&this.initDefault(),this.options.x_axis.start_freq=i,this.options.x_axis.end_freq=s,this.drawChart()}}},{key:"setLoadMask",value:function(t){t?(this.loadMask.style.display="flex",this.loadMask.innerText="..."):this.loadMask.style.display="none"}},{key:"setLock",value:function(t){t?(this.lockBox.style.display="flex",this.lockBox.style.backgroundColor=r(this.options.lock.background),this.lockBox.style.fontSize=this.options.lock.font_size+"px",this.lockBox.style.color=r(this.options.lock.color),this.lockBox.innerText=this.options.lock.content):this.lockBox.style.display="none"}},{key:"setKey",value:function(t){var i=t.type;if(t.action,null==this.focusInfo.focus)4==i&&(this.onFocusCallback&&this.onFocusCallback("chart"),this.focusInfo.prefocus&&"grid"==this.focusInfo.prefocus.type||this.focusInfo.prefocus&&"switch"==this.focusInfo.prefocus.key?this.focusInfo.focus=this.focusInfo.prefocus:this.focusInfo.focus={type:"chart",key:-1,column:-1,row:-1});else if(0==i){if("chart"!==this.focusInfo.focus.type){var s=this.focusInfo.focus.column,e=this.focusInfo.focus.row-1;e<0&&((s-=1)<0&&(s=this.focusInfo.list.length-1),e=this.focusInfo.list[s].length-1),this.changeFocus(s,e,i)}}else if(1==i){if("chart"!==this.focusInfo.focus.type){var o=this.focusInfo.focus.column,n=this.focusInfo.focus.row+1;n>this.focusInfo.list[o].length-1&&((o+=1)>this.focusInfo.list.length-1&&(o=0),n=0),this.changeFocus(o,n,i)}}else if(2==i){if("chart"!==this.focusInfo.focus.type){var h=this.focusInfo.focus.column-1,a=this.focusInfo.focus.row,r=this.focusInfo.list.length-1;h<0&&(h=r);var l=this.focusInfo.list[h].length-1;a>l&&(a=l),this.changeFocus(h,a,i)}}else if(3==i){if("chart"!==this.focusInfo.focus.type){var c=this.focusInfo.focus.column+1,f=this.focusInfo.focus.row;c>this.focusInfo.list.length-1&&(c=0);var u=this.focusInfo.list[c].length-1;f>u&&(f=u),this.changeFocus(c,f,i)}}else if(4==i){if("chart"==this.focusInfo.focus.type)this.changeFocus(0,0,i);else if("button"==this.focusInfo.focus.type)"zoomin"==this.focusInfo.focus.key?document.getElementById("zoom_in").click():"switch"==this.focusInfo.focus.key&&document.getElementById("switch_button").click();else if("grid"==this.focusInfo.focus.type){var d=this.focusInfo.focus.key,_=this.getGridInfo(this.treeData,d);this.selectedArea=_,this.onClickGridCallback&&(this.onClickGridCallback(_),this.focusInfo.prefocus=this.focusInfo.focus,this.onFocusCallback&&this.onFocusCallback(""))}}else 5==i?"chart"==this.focusInfo.focus.type?(this.focusInfo.prefocus=null,this.focusInfo.focus=null,this.onFocusCallback&&this.onFocusCallback("")):(this.focusInfo.prefocus=null,this.focusInfo.focus={type:"chart",key:-1,column:-1,row:-1}):6==i&&(this.focusInfo.prefocus=this.focusInfo.focus,this.focusInfo.focus=null,this.onFocusCallback&&this.onFocusCallback(""));this.drawChart()}},{key:"setZoom",value:function(t){2==t?(this.zoomStatus=2,this.zoomBox.style.backgroundImage='url("img/down.png")'):(this.zoomStatus=1,this.zoomBox.style.backgroundImage='url("img/up.png")')}},{key:"changeFocus",value:function(t,i,s){this.focusInfo.focus&&(this.focusInfo.prefocus=this.focusInfo.focus);for(var e=this.focusInfo.list[t],o=0;o<e.length;o++){var n=e[o];if(n.row==i){this.focusInfo.focus=n;break}}}},{key:"selcetedFocus",value:function(){if(this.clearElmentFocus(),null==this.focusInfo.focus)return!1;"chart"==this.focusInfo.focus.type||"button"==this.focusInfo.focus.type?"chart"==this.focusInfo.focus.type?document.getElementById("mycanvas").classList.add("active"):"zoomin"==this.focusInfo.focus.key?document.getElementById("zoom_in").classList.add("active"):"switch"==this.focusInfo.focus.key&&document.getElementById("switch_button").classList.add("active"):this.focusInfo.focus.type}},{key:"clearElmentFocus",value:function(){for(var t=document.querySelectorAll(".active"),i=0;i<t.length;i++)t[i].classList.remove("active")}},{key:"getArrMaxLength",value:function(t){for(var i=0,s=0;s<t.length;s++)t[s].length>i&&(i=t[s].length);return i}},{key:"getFreqRange",value:function(t){for(var i=1/0,s=-1/0,e=0;e<t.length;e++){var o=t[e];o&&(i=Math.min(i,o.start_freq,o.end_freq),s=Math.max(s,o.start_freq,o.end_freq))}return{min:i,max:s}}},{key:"layoutEvents",value:function(t){var i=[];return t.slice().sort((function(t,i){return t.start_freq-i.start_freq||i.end_freq-i.start_freq-(t.end_freq-t.start_freq)||t.end_freq-i.end_freq})).forEach((function(t){for(var s=!1,e=0;e<i.length;e++){var o=i[e];if(l(o,t)){o.push(t),s=!0;break}}if(!s){for(var n=-1,h=1/0,a=0;a<i.length;a++){var r=i[a][i[a].length-1];t.start_freq>=r.end_freq-1&&r.end_freq<h&&(n=a,h=r.end_freq)}if(-1!==n){var c=i[n][i[n].length-1];c.end_freq>t.start_freq&&(c.end_freq=t.start_freq-1),i[n].push(t)}else i.push([t])}})),1===i.length&&1===i[0].length&&(i=[i[0]]),i}},{key:"computSort",value:function(t){return t.slice().sort((function(t,i){return t.start_freq-i.start_freq||i.end_freq-i.start_freq-(t.end_freq-t.start_freq)||t.end_freq-i.end_freq}))}},{key:"debounce",value:function(t,i){var s;return function(){for(var e=this,o=arguments.length,n=new Array(o),h=0;h<o;h++)n[h]=arguments[h];clearTimeout(s),s=setTimeout((function(){return t.apply(e,n)}),i)}}},{key:"throttle",value:function(t,i){var s=0;return function(){var e=(new Date).getTime();if(e-s>=i){for(var o=arguments.length,n=new Array(o),h=0;h<o;h++)n[h]=arguments[h];t.apply(this,n),s=e}}}},{key:"destroy",value:function(){var t=this;this.canvas.removeEventListener("mousedown",this.mousedown.bind(this)),this.canvas.removeEventListener("mouseup",this.mouseup.bind(this)),this.canvas.removeEventListener("mousemove",this.mousemove.bind(this)),this.canvas.removeEventListener("mouseout",this.mouseout.bind(this)),this.canvas.removeEventListener("touchstart",this.touchstart.bind(this)),this.canvas.removeEventListener("touchmove",this.touchmove.bind(this)),this.canvas.removeEventListener("touchend",this.touchend.bind(this)),this.canvas.removeEventListener("wheel",this.handleWheel.bind(this)),this.canvas.removeEventListener("dblclick",this.handleDblClick.bind(this)),this.canvas.removeEventListener("click",this.handleClick.bind(this)),this.canvas.removeEventListener("contextmenu",this.handleContextMenu.bind(this)),window.removeEventListener("keydown",this.handleKeydown.bind(this)),window.removeEventListener("keyup",this.handleKeyup.bind(this)),window.removeEventListener("resize",(function(){return t.resizeCanvas()})),this.treeData=null,this.inittreeData=null}},{key:"showconsole",value:function(t){if(!this.options.isPrint)return!1;"object"===n(t)&&null!==t&&(t=JSON.stringify(t));var i="<p><span></span>"+t.replace(/\s+/g,"")+"</p>";document.getElementById("consolelogs").innerHTML+=i}}],s&&t(i.prototype,s),o&&t(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,o}();module.exports=c;
//# sourceMappingURL=freqChart.cjs.js.map
