"use strict";function t(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,s=Array(i);e<i;e++)s[e]=t[e];return s}function i(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,a(s.key),s)}}function e(t,i,e){return(i=a(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function s(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function o(t){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?s(Object(o),!0).forEach((function(i){e(t,i,o[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(o,i))}))}return t}function n(i){return function(i){if(Array.isArray(i))return t(i)}(i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(i,e){if(i){if("string"==typeof i)return t(i,e);var s={}.toString.call(i).slice(8,-1);return"Object"===s&&i.constructor&&(s=i.constructor.name),"Map"===s||"Set"===s?Array.from(i):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?t(i,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){var i=function(t,i){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function r(t,i){for(var e in i)i.hasOwnProperty(e)&&("object"!==h(i[e])||null===i[e]||Array.isArray(i[e])||Array.isArray(t[e])?t[e]=i[e]:(t[e]||(t[e]={}),r(t[e],i[e])));return t}function l(t,i){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isNaN(t)||isNaN(i))throw new Error("Invalid input: num and decimalPlaces must be numbers.");if(""===i)return t;i=Math.max(0,Math.floor(i));var s=Math.pow(10,i),o=Math.trunc(t*s)/s;return e?parseFloat(o.toFixed(i)):o.toFixed(i)}var d=function(){return t=function t(i,e){var s=this;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.devicePixelRatio=window.devicePixelRatio||1,this.loadOptions=e,this.box=document.getElementById(i),this.box.style.position="relative",this.box.innerHTML="",this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.box.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!0,this.initOptions(e),this.setCanvasSize(),this.refreshInterval=null,this.isDraw=!0,this.thresholdDiv=null,this.thresholdFouce=!1,this.fretipDiv=null,this.chartWidth=0,this.chartHeight=0,this.ygridStep=0,this.yZoom=1,this.tracesData=[],this.focusType="",this.throttleDelay=e.throttleDelay||100,this.lastCallTime=0,this.wheelListener=this.handleWheel.bind(this),this.init(),this.canvas.addEventListener("mousedown",this.mousedown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseup.bind(this)),this.canvas.addEventListener("mousemove",this.mousemove.bind(this)),this.canvas.addEventListener("mouseout",this.mouseout.bind(this)),this.canvas.addEventListener("wheel",this.wheelListener),this.canvas.addEventListener("dblclick",this.handleDblClick.bind(this)),this.canvas.addEventListener("click",this.handleClick.bind(this)),this.canvas.addEventListener("contextmenu",this.handleContextMenu.bind(this)),window.addEventListener("keydown",this.handleKeydown.bind(this)),window.addEventListener("keyup",this.handleKeyup.bind(this)),window.addEventListener("resize",(function(){return s.resizeCanvas()})),this.mousedownInfo={isMouseDown:!1,startX:0,startY:0,mouseupx:0,mouseupy:0,button:0},this.moveInfo={isMove:!1,preX:0,preY:0,moveX:0,moveY:0},this.initthreshold(),this.initFredTip()},e=[{key:"setCanvasSize",value:function(t,i){var e=t||this.options.width,s=i||this.options.height,o=this.box.clientWidth||400,n=this.box.clientHeight||300;this.canvas.width="100%"===e?o:e,this.canvas.height="100%"===s?n:s,this.canvas.style.width="".concat("100%"===e?o:e,"px"),this.canvas.style.height="".concat("100%"===s?n:s,"px"),this.width=this.canvas.width,this.height=this.canvas.height}},{key:"initOptions",value:function(t){var i=r({},{type:"FFT",duration:50,width:400,height:300,background:"#CCCCCC",center_freq:"",span:"",is_drag_zoom:!0,grid:{left:50,top:40,bottom:50,right:40,color:"#B7B7B7",background:"transparent",width:1,xgrid_show:!0,xgrid_line_dash:[],ygrid_show:!0,ygrid_line_dash:[],center_line_show:!1,center_color:"#FF0000",center_width:1},legend:{visible:!1},xaxis:{number:5,unit:"",unit_two_line:!0,unit_right:10,decimals:"",dscan_freq:[],dscan_space:10,text_color:"#343434",text_font_size:12,text_font_family:"Arial",color:"#333",width:1,labels:[[{offsetx:0,text:19},{offsetx:30,text:20}]],label_two_line:!0,label_angle:0,draw_zoom_freq:"",draw_zoom_span:""},yaxis:{number:5,unit:"",decimals:"",fixedStep:20,init_min_value:-30,init_max_value:60,min_value:-30,max_value:60,floor_value:-60,ceiling_value:140,text_color:"#343434",text_font_size:12,text_font_family:"Arial",color:"#333",width:1,axis_function:function(t){return t},zoom_value:"",labels:[]},marker:{visible:!0,tip_show:!0,freqdiff_show:!0,is_add:!0,color:"#FF0000",width:1,focus_color:"#FF0000",focus_width:1,text_color:"#FFFFFF",text_font_size:12,text_font_family:"Arial",background:"#000000",border_radius:6,difftext_color:"#FF0000",difftext_font_size:12,difftext_font_family:"Arial",diff_background:"#000000",diff_border_radius:6},threshold:{visible:!1,is_darg:!0,is_mouse:!1,level:30,decimals:2,color:"#19A9EB",width:1,drag_color:"#3FFDB1",drag_width:1,text_color:"#333",text_font_size:12,drag_text_color:"#3FFDB1",drag_text_font_size:14,icon_url:"",drag_icon_url:"",icon_size:[30,20]},sptm_area:{visible:!1,background:"ragb(0,0,0,0.5)",drag_background:"ragb(0,0,0,0.5)",start_freq:0,end_freq:0},level_tipline:{visible:!1,freq_visible:!1,color:"#00afff",width:1,text_color:"#333",text_font_size:12,is_draw:!1,point:{pointx:0,pointy:0}}});this.options=r(i,t),this.options.grid.left=Math.floor(this.options.grid.left*this.devicePixelRatio),this.options.grid.bottom=Math.floor(this.options.grid.bottom*this.devicePixelRatio),this.options.grid.top=Math.floor(this.options.grid.top*this.devicePixelRatio),this.options.grid.right=Math.floor(this.options.grid.right*this.devicePixelRatio),this.options.yaxis.init_min_value=this.options.yaxis.min_value,this.options.yaxis.init_max_value=this.options.yaxis.max_value,this.yLabelGridInfo={},this.xLabelGridInfo=[],this.options.yaxis.fixedStep=(this.options.yaxis.ceiling_value-this.options.yaxis.floor_value)/(this.options.yaxis.number-1)}},{key:"init",value:function(){this.clearCanvas(),this.initBackground(),this.drawAxis(),this.drawGrid()}},{key:"initthreshold",value:function(){var t=document.createElement("div");t.className="sptmchart_threshold",t.style.position="absolute",t.style.width="".concat(this.options.threshold.icon_size[0]*this.devicePixelRatio,"px"),t.style.height="".concat(this.options.threshold.icon_size[1]*this.devicePixelRatio,"px"),t.style.backgroundImage="url(".concat(this.options.threshold.icon_url,")"),t.style.backgroundSize="100% 100%";var i=this.options.grid.left-this.options.threshold.icon_size[0]*this.devicePixelRatio;t.style.left="".concat(i,"px"),t.style.display="none",this.canvas.parentNode.appendChild(t),this.thresholdDiv=t,this.thresholdDiv.addEventListener("mousedown",this.thresholdMousedown.bind(this)),this.thresholdDiv.addEventListener("mousemove",this.thresholdMousemove.bind(this)),this.thresholdDiv.addEventListener("mouseout",this.thresholdMouseout.bind(this)),this.thresholdDiv.addEventListener("mouseup",this.thresholdMouseout.bind(this))}},{key:"initFredTip",value:function(){var t=document.createElement("span");t.className="sptmchart_freqtip",t.style.display="none",t.style.position="absolute",t.style.color=this.options.level_tipline.text_color,t.style.fontSize="".concat(this.options.level_tipline.text_size*this.devicePixelRatio,"px"),this.canvas.parentNode.appendChild(t),this.fretipDiv=t}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"initBackground",value:function(){this.ctx.fillStyle=this.options.background,this.ctx.fillRect(0,0,this.width,this.height)}},{key:"drawAxis",value:function(){var t=this;this.cumputeLabels(),this.ctx.strokeStyle=this.options.xaxis.color,this.ctx.lineWidth=this.options.xaxis.width||1,this.ctx.beginPath(),this.ctx.moveTo(this.options.grid.left,this.height-this.options.grid.bottom),this.ctx.lineTo(this.width-this.options.grid.right,this.height-this.options.grid.bottom),this.ctx.stroke(),this.ctx.fillStyle=this.options.xaxis.text_color,this.ctx.textBaseline="top",this.ctx.font="".concat(this.options.xaxis.text_font_size*this.devicePixelRatio,"px ").concat(this.options.xaxis.text_font_family),this.options.xaxis.labels.forEach((function(i,e){for(var s=0;s<i.length;s++){var o=i[s],n=l(o.text,t.options.xaxis.decimals),a=t.options.xaxis.label_angle*Math.PI/180,h=t.options.grid.left+o.offsetx,r=t.height-t.options.grid.bottom+8;if(t.options.xaxis.label_two_line)t.ctx.textAlign="center",e>0&&0==s&&(r=t.height-t.options.grid.bottom+t.options.grid.bottom/2),t.ctx.fillText(n,h,r);else if(t.options.xaxis.label_angle>0)t.ctx.save(),t.ctx.translate(h,r),t.ctx.rotate(a),t.ctx.fillText(n,0,0),t.ctx.restore();else{t.ctx.textAlign="center";var d=t.ctx.measureText(n).width/2;s===i.length-1&&e<t.options.xaxis.labels.length-1&&(h=t.options.grid.left+o.offsetx-d),e>0&&0==s&&(h=t.options.grid.left+o.offsetx+d),t.ctx.fillText(n,h,r)}}})),""!==this.options.xaxis.unit&&(this.options.xaxis.unit_two_line?this.ctx.fillText(this.options.xaxis.unit,this.width-this.options.grid.right-4,this.height-this.options.grid.bottom+this.options.grid.bottom/2):this.ctx.fillText(this.options.xaxis.unit,this.width-this.options.grid.right+this.options.xaxis.unit_right,this.height-this.options.grid.bottom+8)),this.ctx.strokeStyle=this.options.yaxis.color,this.ctx.lineWidth=this.options.yaxis.width||1,this.ctx.beginPath(),this.ctx.moveTo(this.options.grid.left,this.options.grid.top),this.ctx.lineTo(this.options.grid.left,this.height-this.options.grid.bottom),this.ctx.stroke(),this.ctx.fillStyle=this.options.yaxis.text_color||"#343434",this.ctx.textAlign="right",this.ctx.textBaseline="middle",this.ctx.font="".concat(this.options.yaxis.text_font_size*this.devicePixelRatio,"px ").concat(this.options.yaxis.text_font_family),this.options.yaxis.labels.forEach((function(i,e){var s=t.height-t.options.grid.bottom-i.offsetY,o=l(t.options.yaxis.axis_function(i.text),t.options.yaxis.decimals);t.ctx.fillText(o,t.options.grid.left-5,s)})),""!==this.options.yaxis.unit&&this.ctx.fillText(this.options.yaxis.unit,this.options.grid.left-5,this.options.grid.top/2)}},{key:"drawLegend",value:function(){var t=this,i=this.options,e=i.grid,s=i.legend;if(!s.visible)return!1;var o=this.tracesData.map((function(i,e){if(i.visible){var s=i.name||"数据 ".concat(e+1),o=i.color;return{label:s,width:t.ctx.measureText(s).width+20,color:o}}})),n=o.reduce((function(t,i){return t+i.width+15}),0)-20,a=(this.width-n)/2,h=e.top/2;this.ctx.fillStyle=s.color;var r=a;o.forEach((function(i,e){t.ctx.fillStyle=i.color,t.ctx.fillRect(r,h-5,10,10),t.ctx.fillStyle=s.color,t.ctx.textAlign="left",t.ctx.fillText(i.label,r+20,h),r+=i.width+15}))}},{key:"drawGrid",value:function(){var t=this;this.ctx.fillStyle=this.options.grid.background,this.ctx.fillRect(this.options.grid.left,this.options.grid.top,this.chartWidth,this.chartHeight),this.ctx.strokeStyle=this.options.grid.color,this.ctx.lineWidth=this.options.grid.width,this.ctx.setLineDash(this.options.grid.ygrid_line_dash),this.options.grid.ygrid_show&&this.options.xaxis.labels.length>0&&this.options.xaxis.labels.forEach((function(i,e){for(var s=0;s<i.length;s++){var o=t.options.grid.color;(t.options.xaxis.labels.length>1&&0==e&&s==i.length-1||t.options.xaxis.labels.length>1&&e>0&&(0==s||s==i.length-1))&&(o="green"),t.ctx.beginPath(),t.ctx.strokeStyle=o;var n=i[s];t.ctx.moveTo(t.options.grid.left+n.offsetx,t.options.grid.top),t.ctx.lineTo(t.options.grid.left+n.offsetx,t.height-t.options.grid.bottom),t.ctx.stroke()}}));var i=this.yLabelGridInfo.gridLabels.length;if(this.ctx.strokeStyle=this.options.grid.color,this.ctx.setLineDash(this.options.grid.xgrid_line_dash),this.ctx.beginPath(),this.options.grid.xgrid_show&&i>0)for(var e=0;e<=i;e++){var s=(this.yLabelGridInfo.gridLabels[e]-this.options.yaxis.min_value)*this.yLabelGridInfo.pxStep;this.ctx.moveTo(this.options.grid.left,this.height-this.options.grid.bottom-s),this.ctx.lineTo(this.width-this.options.grid.right,this.height-this.options.grid.bottom-s),this.ctx.stroke()}this.ctx.setLineDash([]),this.options.grid.center_line_show&&(this.ctx.strokeStyle=this.options.grid.center_color,this.ctx.lineWidth=this.options.grid.center_width,this.ctx.beginPath(),this.ctx.moveTo(this.options.grid.left+this.chartWidth/2,this.options.grid.top),this.ctx.lineTo(this.options.grid.left+this.chartWidth/2,this.height-this.options.grid.bottom),this.ctx.stroke())}},{key:"draw",value:function(){this.clearCanvas(),this.drawAxis(),this.drawGrid(),this.drawLegend(),this.drawTraces(),this.drawOther()}},{key:"drawChart",value:function(){var t=this;this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null),this.options.duration&&this.options.duration>0&&this.isDraw?this.refreshInterval=setInterval((function(){t.draw()}),this.options.duration):this.draw()}},{key:"drawThreshold",value:function(){if(this.options.threshold.visible){var t=this.options.threshold.color,i=this.options.threshold.width;this.options.threshold.is_mouse||this.thresholdFouce?(t=this.options.threshold.drag_color,i=this.options.threshold.drag_width,this.thresholdDiv.style.cursor="pointer",this.thresholdDiv.style.backgroundImage="url(".concat(this.options.threshold.drag_icon_url,")")):(this.thresholdDiv.style.cursor="default",this.thresholdDiv.style.backgroundImage="url(".concat(this.options.threshold.icon_url,")")),this.ctx.strokeStyle=t,this.ctx.lineWidth=i,this.ctx.beginPath();var e=this.height-this.options.grid.bottom-(this.options.threshold.level-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*this.chartHeight;e<this.options.grid.top&&(e=this.options.grid.top),e>this.height-this.options.grid.bottom&&(e=this.height-this.options.grid.bottom);var s="门限:"+l(this.options.yaxis.axis_function(this.options.threshold.level),this.options.threshold.decimals)+this.options.yaxis.unit;this.ctx.moveTo(this.options.grid.left,e),this.ctx.lineTo(this.width-this.options.grid.right,e),this.ctx.stroke();var o=this.ctx.measureText(s).width+20;this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(this.options.grid.left+this.chartWidth/3-10,e-34,o,24),this.ctx.fillStyle=t,this.ctx.textAlign="left",this.ctx.font="".concat(this.options.threshold.text_font_size*this.devicePixelRatio,"px Arial"),this.ctx.textBaseline="middle",this.ctx.fillText(s,this.options.grid.left+this.chartWidth/3,e-20),this.thresholdDiv.style.display="block";var n=e-this.options.threshold.icon_size[1]/2;this.thresholdDiv.style.top="".concat(n,"px")}else this.thresholdDiv.style.display="none"}},{key:"drawTipLine",value:function(){if(this.options.level_tipline.visible&&this.options.level_tipline.point.pointx&&this.tracesData.length>0){var t=this.options.level_tipline.point,i=this.getMousePositionLevel(t);if(i.y.length>0){this.options.level_tipline.is_draw=!0;var e=this.options.level_tipline.color,s=this.options.level_tipline.width;this.ctx.strokeStyle=e,this.ctx.lineWidth=s,this.ctx.beginPath(),this.ctx.moveTo(t.pointx,this.options.grid.top),this.ctx.lineTo(t.pointx,this.height-this.options.grid.bottom),this.ctx.stroke(),this.tipFreqLevel(i)}else this.options.level_tipline.is_draw=!1,this.fretipDiv.style.display="none"}else this.options.level_tipline.is_draw=!1,this.fretipDiv.style.display="none"}},{key:"drawOther",value:function(){this.drawThreshold(),this.drawTipLine()}},{key:"stopChart",value:function(){this.isDraw=!1,this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}},{key:"drawTraces",value:function(){for(var t=0;t<this.tracesData.length;t++)if(this.tracesData[t].datainfo.length>0&&this.tracesData[t].visible)for(var i=this.tracesData[t].datainfo,e=0;e<i.length;e++)this.drawTypeLine(this.tracesData[t],e)}},{key:"drawTypeLine",value:function(t,i){var e=t.datainfo[i];e.width=t.width,e.color=t.color,e.type=t.type,e.drawData=e.data.slice(0),e.order=i;var s=this.xLabelGridInfo[e.order],o=s.width;if(s.start_freq!==s.show_start_freq||s.end_freq!==s.show_end_freq){var n=Math.floor((s.show_start_freq-s.start_freq)*e.point/(s.end_freq-s.start_freq)),a=Math.floor((s.show_end_freq-s.start_freq)*e.point/(s.end_freq-s.start_freq));e.drawData=e.data.slice(n,a)}if(e.drawData.length>o){var h="";e.lineType="pointline",h=this.extractTwoPolesTraceLine(e.data,e.data.length,o),e.drawData=h}else e.drawData.length==o?(e.lineType="line",e.drawData=e.data):e.lineType="step";this.drawLine(e)}},{key:"drawLine",value:function(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(this.options.grid.left,this.options.grid.top,this.chartWidth,this.chartHeight),this.ctx.clip(),this.ctx.beginPath(),this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width||1;var i=t.drawData;"pointline"==t.lineType&&(i=t.drawData.targetData);var e=this.xLabelGridInfo[t.order],s=e.width/(i.length-1);if(e.drawStepPx=s,e.lineType=t.lineType,"line"==t.lineType)for(var o=0;o<i.length;o++){var n=i[o],a=e.start_x,h=this.options.grid.left+a+o*s;if(h>this.width-this.options.grid.right||h<this.options.grid.left)break;var r=this.height-this.options.grid.bottom-(n-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*this.chartHeight;0==o?this.ctx.moveTo(h,r):this.ctx.lineTo(h,r)}else if("step"==t.lineType)for(var l=0;l<t.drawData.length;l++){var d=t.drawData[l],f=e.start_x,c=this.options.grid.left+f,p=c+l*s-s/2,u=c+l*s+s/2;p<this.options.grid.left&&(p=this.options.grid.left),u>this.width-this.options.grid.right&&(u=this.width-this.options.grid.right);var x=this.height-this.options.grid.bottom-(d-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*this.chartHeight;0==l?(this.ctx.moveTo(c,x),this.ctx.lineTo(u,x)):(this.ctx.lineTo(p,x),this.ctx.lineTo(u,x))}else if("pointline"==t.lineType)for(var v=0;v<i.length;v++){var _=i[v][0],g=i[v][1],y=e.start_x,m=this.options.grid.left+y+v*s;if(m>this.width-this.options.grid.right||m<this.options.grid.left)break;var b=this.height-this.options.grid.bottom-(_-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*this.chartHeight,w=this.height-this.options.grid.bottom-(g-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*this.chartHeight;0==v?(this.ctx.moveTo(m,b),this.ctx.lineTo(m,w)):(this.ctx.lineTo(m,b),this.ctx.lineTo(m,w))}this.ctx.stroke(),this.ctx.restore()}},{key:"addTrace",value:function(t){var i=r({id:1,type:"FFT",visible:!0,point:100,name:"",color:"#000",datainfo:[],width:1},t);this.tracesData.push(i),this.isDraw=!0,this.drawChart()}},{key:"setTraceData",value:function(t,i){for(var e=0;e<this.tracesData.length;e++)if(this.tracesData[e].id===t){this.tracesData[e].datainfo=i;break}this.isDraw=!0,this.drawChart()}},{key:"setFFTTraceData",value:function(t,i){for(var e=0;e<this.tracesData.length;e++)if(this.tracesData[e].id===t){this.tracesData[e].datainfo=i;break}this.isDraw=!0,this.drawChart()}},{key:"setDScanTraceData",value:function(t,i){for(var e=0;e<this.tracesData.length;e++)if(this.tracesData[e].id===t){this.tracesData[e].datainfo=i;break}this.drawChart()}},{key:"cumputeLabels",value:function(){this.options.xaxis.labels=[],this.options.yaxis.labels=[],this.chartWidth=Math.floor(this.width-this.options.grid.left-this.options.grid.right),this.chartHeight=Math.floor(this.height-this.options.grid.top-this.options.grid.bottom);var t=function(t,i,e,s,o,n,a,h){var r=[],l=[],d=o||1,f=Math.round(s/d);f<1&&(f=1);for(var c=t/f,p=t,u=i+f*(h-1),x=f/2,v=n;v<=a;v+=f)v>=i&&v<=u&&r.push(v);for(var _=n;_<=a;_+=x)_>=i&&_<=u&&l.push(_);return{labelStep:p,pxStep:c,labels:r,stepValue:f,minDiff:r[0]-i,gridLabels:l,maxValue:u,minValue:i}}(this.chartHeight/(this.options.yaxis.number-1),this.options.yaxis.min_value,this.options.yaxis.max_value,this.options.yaxis.fixedStep,this.yZoom,this.options.yaxis.floor_value,this.options.yaxis.ceiling_value,this.options.yaxis.number);if(this.yLabelGridInfo=t,this.options.yaxis.min_value=t.minValue,this.options.yaxis.max_value=t.maxValue,this.options.grid.right=this.width-this.options.grid.left-this.chartWidth,this.options.grid.bottom=this.height-this.options.grid.top-this.chartHeight,this.ygridStep=t.labelStep,"DScan"==this.options.type){for(var i=this.chartWidth,e=this.options.xaxis.dscan_freq,s=this.options.xaxis.dscan_space,o=[],a=0,h=[],r=0;r<e.length;r++){var l=e[r];h.push(l.width)}var d=function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=t,o=i.length;if(i.length!==o)throw new Error("Widths array must have exactly 5 elements.");var a=i.reduce((function(t,i){return t+Math.max(i,50)}),0),h=(o-1)*e,r=50;if(a+h>s){var l=i.filter((function(t){return 1===t})).length;a-h-1*l<s&&(r=Math.floor((s-h)/l))}var d=i.map((function(t){return 1===t?r:t})),f=d.reduce((function(t,i){return t+i}),0),c=(o-1)*e;if(f+c<s){var p=s-(f+c),u=d.filter((function(t){return t===r})).length;if(u>1)for(var x=Math.floor(p/u),v=0;v<o;v++)d[v]==r&&(d[v]+=x);else for(var _=Math.floor(p/o),g=0;g<o;g++)d[g]+=_}else{var y=Math.ceil((f+c-s)/o);Math.min.apply(Math,n(d));for(var m=0;m<o;m++)d[m]-=y}return{widths:d.map(Math.floor).map((function(t){return Math.max(t,0)})),spacing:e,sumCout:d.reduce((function(t,i){return t+i}),0)}}(this.chartWidth,h,s);i=d.widths;for(var f=0;f<e.length;f++){var c=e[f],p=c.start_freq,u=c.end_freq,x=u-p,v=p+(u-p)/2,_=x,g=1;if(this.xLabelGridInfo.length>0){var y=this.xLabelGridInfo[f];""!==y.draw_zoom_freq&&(v=y.draw_zoom_freq),""!==y.draw_zoom&&(g=y.draw_zoom)}var m=2*Math.floor(_/g/2),b=v-m/2,w=b+m,k=this.options.xaxis.number,D=m/(k-1),I=i[f]/(k-1);if(b&&D){for(var T=[],M=0;M<k;M++){var L={text:(b+M*D)/1e6,offsetx:a+I*M};T.push(L)}this.options.xaxis.labels.push(T)}var q={start_freq:p,end_freq:u,width:i[f],span:x,freqStep:D,labelStepPx:I,show_start_freq:b,show_end_freq:w,start_x:a,end_x:a+i[f],drawStepPx:"",draw_zoom:g,draw_zoom_freq:v,draw_zoom_span:m};o.push(q),a+=i[f]+d.spacing}this.xLabelGridInfo=o}else{var S=1;if(""!==this.options.center_freq&&""!==this.options.span){var P=this.options.center_freq,z=this.options.span;if(this.xLabelGridInfo.length>0){var C=this.xLabelGridInfo[0];""!==C.draw_zoom_freq&&(P=C.draw_zoom_freq),""!==C.draw_zoom&&(S=C.draw_zoom)}var G=2*Math.floor(z/S/2),F=P-G/2,E=F+G,O=this.options.xaxis.number,A=G/(O-1),W=this.chartWidth/(O-1);if(F&&A){for(var Y=[],X=0;X<this.options.xaxis.number;X++){var R={text:(F+X*A)/1e6,offsetx:W*X};Y.push(R)}this.options.xaxis.labels.push(Y)}var j={start_freq:this.options.center_freq-this.options.span/2,end_freq:this.options.center_freq+this.options.span/2,width:this.chartWidth,span:this.options.span,freqStep:A,labelStepPx:W,show_start_freq:F,show_end_freq:E,start_x:0,end_x:this.chartWidth,drawStepPx:"",draw_zoom:S,draw_zoom_freq:P,draw_zoom_span:G};this.xLabelGridInfo=[j]}}if(""!==this.options.yaxis.min_value){""==this.options.yaxis.zoom_value&&(this.options.yaxis.init_min_value=this.options.yaxis.min_value,this.options.yaxis.init_max_value=this.options.yaxis.max_value,this.options.yaxis.zoom_value=this.options.yaxis.min_value+(this.options.yaxis.max_value-this.options.yaxis.min_value)/2);for(var H=0;H<t.labels.length;H++){var B=t.labels[H],V={text:B,offsetY:(B-this.options.yaxis.min_value)*t.pxStep};this.options.yaxis.labels.push(V)}}}},{key:"selectDataIndex",value:function(t,i,e){return i>=t||0==t||0==e?0:1==e?Math.floor(t/2):e==t?i:t>e?Math.floor((i+1)*t/e)-1:Math.floor(i*t/e)}},{key:"extractTraceData",value:function(t,i,e){var s=[],o=[],n=0,a=0;n=this.selectDataIndex(i,a,e);for(var h=!1,r=0,l=-1,d=0;d<i;d++)h?t[d]>r&&(r=t[d],l=d):(r=t[d],l=d,h=!0),n==d&&(s[a]=r,o[a]=l,a++,h=!1,n=this.selectDataIndex(i,a,e));return{targetData:s,dataIndex:o}}},{key:"extractTwoPolesTraceLine",value:function(t,i,e){var s=[],o=[],n=0,a=0;n=this.selectDataIndex(i,a,e);for(var h=!1,r=0,l=0,d=-1,f=-1,c=0;c<i;c++)h?(t[c]>r&&(r=t[c],f=c),t[c]<l&&(l=t[c],d=c)):(r=t[c],l=t[c],f=c,d=c,h=!0),n==c&&(s[a]=[r,l],o[a]=[f,d],a++,h=!1,n=this.selectDataIndex(i,a,e));return{targetData:s,dataIndex:o}}},{key:"mousedown",value:function(t){this.mousedownInfo={isMouseDown:!0,startX:t.offsetX,startY:t.offsetY,mouseupx:0,mouseupy:0,button:t.button},0===t.button?this.ctx.canvas.style.cursor="grabbing":2===t.button&&(this.ctx.canvas.style.cursor="grab")}},{key:"mouseup",value:function(t){var i={isMouseDown:!1,mouseupx:t.offsetX,mouseupy:t.offsetY,button:t.button};this.mousedownInfo=o(o({},this.mousedownInfo),i),this.ctx.canvas.style.cursor="default"}},{key:"mousemove",value:function(t){if(t.offsetX,t.offsetY,this.mousedownInfo.isMouseDown){0==this.moveInfo.preX&&(this.moveInfo.preX=this.mousedownInfo.startX,this.moveInfo.preY=this.mousedownInfo.startY);var i=t.offsetX-this.moveInfo.preX,e=this.moveInfo.preY-t.offsetY,s=t.offsetX-this.mousedownInfo.startX,o=t.offsetY-this.mousedownInfo.startY;if(Math.abs(s)>Math.abs(o)){var n=this.getMouseVal(t).order;if(null==n);else{var a=this.xLabelGridInfo[n],h=Math.ceil(Math.abs(a.show_end_freq-a.show_start_freq)/a.width*i);0==h&&(h=Math.sign(e));var r=a.show_start_freq-h,l=a.show_end_freq-h;if(r>=a.start_freq&&l<=a.end_freq){this.xLabelGridInfo[n].show_start_freq=r,this.xLabelGridInfo[n].show_end_freq=l;var d=r+Math.floor((l-r)/2);this.xLabelGridInfo[n].draw_zoom_freq=d,this.drawChart()}}}else{var f=Math.ceil(Math.abs(this.options.yaxis.max_value-this.options.yaxis.min_value)/this.chartHeight*e);0==f&&(f=Math.sign(e));var c=this.options.yaxis.min_value-f,p=this.options.yaxis.max_value-f;c>=this.options.yaxis.floor_value&&p<=this.options.yaxis.ceiling_value&&(this.options.yaxis.min_value=c,this.options.yaxis.max_value=p,this.drawChart())}0===this.mousedownInfo.button||this.mousedownInfo.button}else if("grid"==this.getMousePosition()){var u=this.getMousePoint(t);this.options.level_tipline.point=u,this.drawChart()}else this.options.level_tipline.is_draw&&(this.options.level_tipline.point.pointx=null,this.options.level_tipline.is_draw=!1);this.moveInfo={isMove:!0,preX:t.offsetX,preY:t.offsetY,moveX:t.offsetX,moveY:t.offsetY}}},{key:"mouseout",value:function(t){t.preventDefault(),this.mousedownInfo.isMouseDown=!1,this.moveInfo={isMove:!1,preX:0,preY:0,moveX:0,moveY:0}}},{key:"handleWheel",value:function(t){var i=this;t.preventDefault();var e=t.deltaY<0?1:-1;this.throttle((function(){i.handleZoom(t,e)}))}},{key:"throttle",value:function(t){var i=Date.now();i-this.lastCallTime>=this.throttleDelay&&(this.lastCallTime=i,t())}},{key:"handleDblClick",value:function(t){}},{key:"handleClick",value:function(t){this.getMousePosition(t)}},{key:"handleContextMenu",value:function(t){}},{key:"handleKeydown",value:function(t){switch(t.keyCode){case 37:case 39:break;case 38:this.changeThreshold(.5);break;case 40:this.changeThreshold(-.5)}}},{key:"handleKeyup",value:function(t){switch(t.keyCode){case 37:case 39:break;case 38:case 40:this.options.threshold.is_mouse=!1}}},{key:"thresholdMousedown",value:function(t){this.focusType="threshold",this.thresholdFouce=!0}},{key:"thresholdMousemove",value:function(t){if(this.thresholdFouce){var i=this.getMouseVal(t,2).y;this.options.threshold.level=i,this.drawChart()}}},{key:"thresholdMouseout",value:function(t){this.thresholdFouce=!1}},{key:"tipFreqLevel",value:function(t){if(this.options.level_tipline.is_draw){this.fretipDiv.style.display="block",t.pointx-this.options.grid.left>this.chartWidth/2?(this.fretipDiv.style.left="",this.fretipDiv.style.right="".concat(this.width-t.pointx+10,"px")):(this.fretipDiv.style.right="",this.fretipDiv.style.left="".concat(t.pointx+10,"px")),this.fretipDiv.style.top="".concat(this.options.grid.top+40,"px");var i=Math.max.apply(Math,n(t.y)),e=this.options.yaxis.axis_function(i);this.options.level_tipline.freq_visible?this.fretipDiv.innerText="强度：".concat(e).concat(this.options.yaxis.unit," \n频率：").concat(t.x/1e6," MHz"):this.fretipDiv.innerText="强度：".concat(e).concat(this.options.yaxis.unit)}else this.fretipDiv.style.display="none"}},{key:"setFFTCenterFreAndSpan",value:function(t,i){this.options.center_freq=t,this.options.span=i}},{key:"getFFTCenterFreAndSpan",value:function(){return{center_freq:this.options.center_freq,span:this.options.span}}},{key:"resizeCanvas",value:function(){this.setCanvasSize(),this.draw()}},{key:"setChartSize",value:function(t,i){t&&i&&(this.options.width=t,this.options.height=i),this.setCanvasSize(t,i),this.draw()}},{key:"changeThreshold",value:function(t){if(this.options.threshold.visible){var i=this.options.threshold.level+t;this.options.threshold.is_mouse=!0,i<=this.options.yaxis.max_value&&i>=this.options.yaxis.min_value&&(this.options.threshold.level=i)}}},{key:"setThresholdLevel",value:function(t){this.options.threshold.level=t}},{key:"getThresholdLevel",value:function(){return this.options.threshold.level}},{key:"setThresholdShow",value:function(t){this.options.threshold.visible=t}},{key:"setThresholdAttribute",value:function(t){var i=r({},this.options.threshold);this.options.threshold=r(i,t)}},{key:"handleZoom",value:function(t,i){var e=this.getMousePosition();if("left"==e){var s=this.yZoom+i;this.options.yaxis.fixedStep;var o=(this.options.yaxis.ceiling_value-this.options.yaxis.floor_value)/(this.options.yaxis.number-1);if(s<1)return s=1,!1;s>o&&(s=o);var n=Math.round(o/s);if(n<1)return!1;var a=n*(this.options.yaxis.number-1),h=this.getMouseVal(t,0).y,r=Math.round(h-(h-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*a),l=Math.floor(r+a);r<this.options.yaxis.floor_value&&(l=(r=this.options.yaxis.floor_value)+a),l>this.options.yaxis.ceiling_value&&(r=(l=this.options.yaxis.ceiling_value)-a),r>=this.options.yaxis.floor_value&&l<=this.options.yaxis.ceiling_value&&l-r>=this.options.yaxis.number-1&&(this.options.yaxis.min_value=r,this.options.yaxis.max_value=l,this.yZoom=s)}else if("bottom"==e){var d=this.getMouseVal(t,0);if(null!==d.order){var f=d.order,c=this.xLabelGridInfo[f],p=c.span,u=c.draw_zoom+i*Math.pow(2,2),x=2*Math.floor(p/u/2);if(x>p)return!1;if(x<6)return!1;var v=d.x,_=Math.floor(v-(v-c.show_start_freq)/(c.show_end_freq-c.show_start_freq)*x),g=Math.floor(_+x);if(_<c.start_freq&&(_=c.start_freq,g=Math.floor(_+x)),g>c.end_freq&&(g=c.end_freq,_=Math.ceil(g-x)),_>=c.start_freq&&g<=c.end_freq){this.xLabelGridInfo[f].draw_zoom=u;var y=_+Math.floor((g-_)/2);this.xLabelGridInfo[f].draw_zoom_freq=y}}}this.drawChart()}},{key:"getMouseVal",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top,n=null,a=null,h=null;if(a=o<this.options.grid.top?this.options.yaxis.max_value:o>this.height-this.options.grid.bottom?this.options.yaxis.min_value:this.options.yaxis.max_value-(o-this.options.grid.top)/this.chartHeight*(this.options.yaxis.max_value-this.options.yaxis.min_value),s<this.options.grid.left)n=this.xLabelGridInfo[0].show_start_freq,h=0;else{s-=this.options.grid.left;for(var r=0;r<this.xLabelGridInfo.length;r++)if(s>=this.xLabelGridInfo[r].start_x&&s<=this.xLabelGridInfo[r].end_x){n=this.xLabelGridInfo[r].show_start_freq+(s-this.xLabelGridInfo[r].start_x)/this.xLabelGridInfo[r].width*(this.xLabelGridInfo[r].show_end_freq-this.xLabelGridInfo[r].show_start_freq),n=Math.floor(n),h=r;break}}return{x:n,y:a=0==i?Math.floor(a):1*a.toFixed(i),order:h}}},{key:"getMousePoint",value:function(t){var i=this.canvas.getBoundingClientRect();return{pointx:t.clientX-i.left,pointy:t.clientY-i.top}}},{key:"getMousePositionLevel",value:function(t){var i=t.pointx,e=t.pointy,s=null,o=null,n=[],a=null;if(i<this.options.grid.left||i>this.options.grid.left+this.chartWidth)return{x:s,y:n,xorder:o,order:a,pointx:i,pointy:e};for(var h=i-this.options.grid.left,r=0;r<this.xLabelGridInfo.length;r++)if(h>=this.xLabelGridInfo[r].start_x&&h<=this.xLabelGridInfo[r].end_x){if("step"==this.xLabelGridInfo[r].lineType&&(h-=this.xLabelGridInfo[r].drawStepPx/2)<0&&(h=0),s=this.xLabelGridInfo[r].show_start_freq+(h-this.xLabelGridInfo[r].start_x)/this.xLabelGridInfo[r].width*(this.xLabelGridInfo[r].show_end_freq-this.xLabelGridInfo[r].show_start_freq),s=Math.floor(s),a=r,null==this.tracesData[0].datainfo[r]||null==this.tracesData[0].datainfo[r]){n=[];break}if(null!=(o=Math.round((s-this.xLabelGridInfo[r].start_freq)/(this.xLabelGridInfo[r].end_freq-this.xLabelGridInfo[r].start_freq)*(this.tracesData[0].datainfo[r].data.length-1))))for(var l=0;l<this.tracesData.length;l++){var d=this.tracesData[l].datainfo[a].data;n.push(d[o])}else n=[];break}return{x:s,y:n,xorder:o,order:a,pointx:i,pointy:e}}},{key:"getMousePosition",value:function(t){var i=window.event,e=this.canvas.getBoundingClientRect(),s=i.clientX-e.left,o=i.clientY-e.top,n="";return n=s<0||s>this.width||o<0||o>this.height?null:s<this.options.grid.left?"left":o<this.options.grid.top?"top":s>this.canvas.width-this.options.grid.right?"right":o>this.canvas.height-this.options.grid.bottom?"bottom":"grid",this.focusType=n,n}},{key:"getOptions",value:function(){return this.options}},{key:"setOptions",value:function(t){var i=r(this.options,t);this.initOptions(i)}}],e&&i(t.prototype,e),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,s}();module.exports=d;
//# sourceMappingURL=sptmChart.cjs.js.map
