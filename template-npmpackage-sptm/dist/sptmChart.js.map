{"version":3,"file":"sptmChart.js","sources":["../src/utils/index.js","../src/index.js"],"sourcesContent":["/**\r\n * 深度合并对象\r\n * @param {*} target 目标对象\r\n * @param {*} source 源对象\r\n * @returns \r\n */\r\nfunction deepMerge(target, source) {\r\n  for (const key in source) {\r\n    if (source.hasOwnProperty(key)) {\r\n      if (typeof source[key] === 'object' && source[key] !== null && !Array.isArray(source[key]) && !Array.isArray(target[key])) {\r\n        if (!target[key]) {\r\n          target[key] = {};\r\n        }\r\n        deepMerge(target[key], source[key]);\r\n      } else {\r\n        target[key] = source[key];\r\n      }\r\n    }\r\n  }\r\n  return target;\r\n}\r\n\r\n//拷贝\r\nfunction deepCopy(obj) {\r\n  // 如果传入的不是对象，则直接返回该值（基本类型数据会被直接返回）\r\n  if (typeof obj !== 'object' || obj === null) {\r\n      return obj;\r\n  }\r\n\r\n  // 根据传入对象的类型创建一个新的目标对象或数组\r\n  let newObj = Array.isArray(obj) ? [] : {};\r\n\r\n  // 遍历原始对象的属性或数组元素\r\n  for (let key in obj) {\r\n      // 只复制对象自身的属性，不复制原型链上的属性\r\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n          // 递归调用深拷贝函数，复制每个属性的值\r\n          newObj[key] = deepCopy(obj[key]);\r\n      }\r\n  }\r\n\r\n  return newObj;\r\n}\r\n/**\r\n * 获取设备像素比 (DPR)\r\n * @returns {number} 当前设备的设备像素比\r\n */\r\nfunction getDevicePixelRatio() {\r\n  return window.devicePixelRatio || 1; // 如果没有定义，则返回 1\r\n}\r\n\r\n/**\r\n * y轴刻度计算\r\n * @param {*} width 高度\r\n * @param {*} minValue 最小值\r\n * @param {*} maxValue 最大值\r\n * @param {*} fixedStep 固定步长\r\n * @param {*} zooms 层级\r\n * @param {*} stepStart 最小刻度范围\r\n * @param {*} stepEnd 最大刻度范围\r\n * @returns \r\n */\r\nfunction calculateStepValues(width,minValue, maxValues, fixedStep,zooms,stepStart, stepEnd,labelnum) {\r\n  console.log(\"计算\",width,minValue, maxValues, fixedStep,zooms,stepStart, stepEnd,labelnum)\r\n  let labels = [];\r\n  let gridLabels=[]\r\n  let zoom=zooms||1;\r\n  let stepValue = Math.round(fixedStep / zoom);\r\n  if(stepValue<1){\r\n    stepValue=1\r\n  }\r\n  let pxStep = width / stepValue;\r\n  let labelStep =width\r\n  \r\n  let maxValue = minValue+stepValue*(labelnum-1);\r\n  console.log(\"计算步进值\",stepValue,labelnum-1,minValue,maxValue,\"传入最大值\",maxValues)\r\n  let gridstepValue=stepValue/2\r\n  // 从第一个步进值开始，找到在 minValue 和 maxValue 范围内的所有步进值\r\n  for (let value = stepStart; value <= stepEnd; value += stepValue) {\r\n      if (value >= minValue && value <= maxValue) {\r\n        labels.push(value);\r\n      }\r\n  }\r\n  for (let value = stepStart; value <= stepEnd; value += gridstepValue) {\r\n    if (value >= minValue && value <= maxValue) {\r\n      gridLabels.push(value);\r\n    }\r\n  }\r\n  let minDiff=labels[0]-minValue\r\n  return {labelStep,pxStep,labels,stepValue,minDiff,gridLabels,maxValue,minValue};\r\n}\r\n\r\n/**\r\n * 计算x轴的宽度\r\n * @param {*} widths 总宽度 \r\n * @param {*} widths 数据宽度 \r\n * @param {*} minSpacing \r\n * @returns \r\n */\r\nfunction calculateWidths(clientWidth,widths, minSpacing = 0) {\r\n  const totalWidth = clientWidth; // 总宽度\r\n  const numberOfSegments = widths.length; // 段数\r\n  const defaultMinWidth = 50; // 默认最小宽度\r\n  const maxSpacing = 30; // 最大间距\r\n\r\n  // 检查输入的 widths 数组长度是否为 5\r\n  if (widths.length !== numberOfSegments) {\r\n      throw new Error(\"Widths array must have exactly 5 elements.\"); // 抛出错误\r\n  }\r\n\r\n  // 计算当前需求\r\n  \r\n  const totalDemand = widths.reduce((a, b) => a + Math.max(b, defaultMinWidth), 0);\r\n  const totalSpacing = (numberOfSegments - 1) * minSpacing; // 计算总间距\r\n\r\n  // 如果当前需求加上间距大于总宽度，调整最小宽度\r\n  let minWidth = defaultMinWidth;\r\n  if (totalDemand + totalSpacing > totalWidth) {\r\n      let minWidthNum = widths.filter(w => w === 1).length;\r\n      if(totalDemand - totalSpacing-minWidthNum*1 <totalWidth){\r\n        minWidth = Math.floor((totalWidth - totalSpacing) / minWidthNum);\r\n      }\r\n      \r\n  }\r\n  const finalWidths = widths.map((w) => w === 1 ? minWidth : w);\r\n  // 调整 finalWidths 根据新的最小宽度\r\n  \r\n\r\n  // 计算已分配的宽度\r\n  const assignedWidth = finalWidths.reduce((a, b) => a + b, 0);\r\n  const assignedSpacing = (numberOfSegments - 1) * minSpacing;\r\n\r\n  // 如果总需求加上间距小于总宽度，进行宽度调整\r\n  if (assignedWidth + assignedSpacing < totalWidth) {\r\n    // 计算剩余宽度\r\n    let remainingWidth = totalWidth - (assignedWidth + assignedSpacing);\r\n    \r\n    // 计算当前宽度为1的元素数量\r\n    const countOfOnes = finalWidths.filter(w => w === minWidth).length;\r\n\r\n    // 计算每个段可以增加的间距\r\n    let extraSpacing = Math.floor(remainingWidth / (numberOfSegments - 1));\r\n    if(countOfOnes>1){\r\n        // 如果有元素为1，则平均增加到那些元素上\r\n        const increasePerOne = Math.floor(remainingWidth / countOfOnes);\r\n        for (let i = 0; i < numberOfSegments; i++) {\r\n            if (finalWidths[i] == minWidth) {\r\n                finalWidths[i] += increasePerOne;\r\n            }\r\n        }\r\n    }else{\r\n        // 如果没有元素为1，均匀增加剩余宽度\r\n        const extraWidthPerSegment = Math.floor(remainingWidth / numberOfSegments);\r\n        for (let i = 0; i < numberOfSegments; i++) {\r\n            finalWidths[i] += extraWidthPerSegment;\r\n        }\r\n    }\r\n  }else{\r\n    // 如果总需求加上间距大于总宽度，则按比例缩小宽度\r\n    const widthDecrease = Math.ceil((assignedWidth + assignedSpacing - totalWidth) / numberOfSegments);\r\n    const minval=Math.min(...finalWidths)\r\n    for (let i = 0; i < numberOfSegments; i++) {\r\n        finalWidths[i] -= widthDecrease;\r\n    }\r\n  }\r\n\r\n  // 返回最终宽度数组，确保所有宽度为整数\r\n  let result={\r\n    widths: finalWidths.map(Math.floor).map(w => Math.max(w, 0)),\r\n    spacing:minSpacing,\r\n    sumCout:finalWidths.reduce((a, b) => a + b, 0)\r\n  }\r\n  return result; // 确保返回整数\r\n}\r\n\r\n/**\r\n * 截取数字的小数点后指定的位数（支持负数，且不足位数补零）\r\n * @param {number} num - 要格式化的数字\r\n * @param {number} decimalPlaces - 要保留的小数位数\r\n * @param {boolean} isnum - 是否为数字\r\n * @returns {number} 截取后的小数位数的数字\r\n */\r\nfunction truncateNumber(num, decimalPlaces,isnum=false) {\r\n  // 处理无效输入\r\n  if (isNaN(num) || isNaN(decimalPlaces)) {\r\n      throw new Error('Invalid input: num and decimalPlaces must be numbers.');\r\n  }\r\n  if(decimalPlaces === \"\"){\r\n    return num\r\n  }\r\n  // 确保小数位数为正整数\r\n  decimalPlaces = Math.max(0, Math.floor(decimalPlaces));\r\n\r\n  // 将数字乘以10的decimalPlaces次方并截取\r\n  const factor = Math.pow(10, decimalPlaces);\r\n  const truncated = Math.trunc(num * factor) / factor; // 截取\r\n  if(isnum){\r\n    //返回浮点数，确保尾数正确\r\n    return parseFloat(truncated.toFixed(decimalPlaces));\r\n  }else{\r\n    // 返回字符串，确保尾数正确\r\n    return truncated.toFixed(decimalPlaces)\r\n  }\r\n  \r\n}\r\n\r\n\r\n\r\nexport {\r\n  deepMerge,\r\n  deepCopy,\r\n  getDevicePixelRatio,\r\n  calculateStepValues,\r\n  calculateWidths,\r\n  truncateNumber\r\n}","import './index.css'\r\nimport {deepMerge,deepCopy,calculateStepValues,calculateWidths,truncateNumber} from './utils'\r\n/**\r\n * sptmChart 频谱控件\r\n *\r\n * @class sptmChart\r\n */\r\nclass sptmChart {\r\n  constructor(id,options) {\r\n    this.devicePixelRatio = window.devicePixelRatio || 1;\r\n    this.loadOptions=options;\r\n    this.box = document.getElementById(id);\r\n    this.box.style.position = \"relative\"\r\n    this.box.innerHTML = '';\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.style.position = \"absolute\";\r\n    this.box.appendChild(this.canvas);\r\n    this.ctx = this.canvas.getContext('2d');\r\n    this.ctx.imageSmoothingEnabled = true; // 启用抗锯齿\r\n    this.initOptions(options);\r\n    this.setCanvasSize();\r\n    this.refreshInterval=null;\r\n    this.isDraw=true\r\n    //门限信息\r\n    this.thresholdDiv=null;\r\n    this.thresholdFouce=false;\r\n    //弹窗tip强度\r\n    this.fretipDiv=null;\r\n    // if (window.devicePixelRatio) {\r\n    //   this.canvas.style.width = this.width + \"px\";\r\n    //   this.canvas.style.height = this.height + \"px\";\r\n    //   this.canvas.height = this.height * window.devicePixelRatio;\r\n    //   this.canvas.width = this.width * window.devicePixelRatio;\r\n    //   this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n    // }\r\n    this.chartWidth = 0;//图表宽度\r\n    this.chartHeight = 0;//图表高度\r\n    // this.yLabelGridInfo={}//y轴标签网格信息\r\n    // this.xLabelGridInfo=[]//x轴标签网格信息\r\n    this.ygridStep=0//图表网格步进宽度\r\n    // this.zoomMax=10//缩放最大值\r\n    // this.zoomMin=1//缩放最小值\r\n    this.yZoom=1//y轴缩放比例\r\n    this.tracesData=[];//数据\r\n    this.focusType=\"\";//聚焦类型 grid|left|right|bottom|threshold|marker\r\n    this.throttleDelay=options.throttleDelay||100;//节流延迟\r\n    this.lastCallTime=0//用于节流时间\r\n    this.wheelListener=this.handleWheel.bind(this)\r\n    this.init();\r\n    this.canvas.addEventListener('mousedown', this.mousedown.bind(this));\r\n    this.canvas.addEventListener('mouseup',this.mouseup.bind(this))\r\n    this.canvas.addEventListener('mousemove', this.mousemove.bind(this));\r\n    this.canvas.addEventListener('mouseout',this.mouseout.bind(this))\r\n    this.canvas.addEventListener('wheel', this.wheelListener);\r\n    this.canvas.addEventListener('dblclick', this.handleDblClick.bind(this));\r\n    this.canvas.addEventListener('click', this.handleClick.bind(this));\r\n    this.canvas.addEventListener('contextmenu', this.handleContextMenu.bind(this));\r\n    window.addEventListener('keydown', this.handleKeydown.bind(this));\r\n    window.addEventListener('keyup', this.handleKeyup.bind(this));\r\n    // 监听窗口调整大小\r\n    window.addEventListener('resize', () => this.resizeCanvas());\r\n    //鼠标按下事件\r\n    this.mousedownInfo={\r\n      isMouseDown:false,\r\n      startX:0,\r\n      startY:0,\r\n      mouseupx:0,\r\n      mouseupy:0,\r\n      button:0\r\n    }\r\n    //鼠标移动事件\r\n    this.moveInfo={\r\n      isMove:false,\r\n      preX:0,\r\n      preY:0,\r\n      moveX:0,\r\n      moveY:0\r\n    }\r\n    //初始门限滑块\r\n    this.initthreshold();\r\n    //初始化提示框\r\n    this.initFredTip();\r\n  }\r\n  /**\r\n   * 设置图表大小\r\n   */\r\n  setCanvasSize(widths, heights) {\r\n    \r\n    const width = widths||this.options.width;\r\n    const height = heights||this.options.height;\r\n    const containerWidth = this.box.clientWidth||400;\r\n    const containerHeight = this.box.clientHeight||300;\r\n    // 使用实际像素大小设置 Canvas\r\n    this.canvas.width = width === \"100%\" ? containerWidth : width;\r\n    this.canvas.height = height === \"100%\" ? containerHeight: height;\r\n\r\n    // 设置 CSS 样式，确保 Canvas 在视觉上保持相应比例\r\n    this.canvas.style.width = width === \"100%\" ? `${containerWidth}px` : `${width}px`;\r\n    this.canvas.style.height = height === \"100%\" ? `${containerHeight}px`: `${height}px`;\r\n    this.width =this.canvas.width;\r\n    this.height =this.canvas.height;\r\n    // 更新字体大小以适应高分辨率\r\n    //this.options.fontSize = `${parseInt(this.options.fontSize) * window.devicePixelRatio}px`;\r\n  }\r\n  /**\r\n   * 初始化配置\r\n   * @param {*} options\r\n   * @memberof sptmChart\r\n   */\r\n  initOptions(options) {\r\n    let defaultOptions = {\r\n      \"type\": \"FFT\",//图表类型 \"FFT\" \"DScan\"\r\n      \"duration\": 50,//一帧持续时间\r\n      \"width\": 400,//画布宽度\r\n      \"height\": 300,//画布高度\r\n      \"background\": \"#CCCCCC\",//背景色\r\n      \"center_freq\": \"\",//中心频率\r\n      \"span\": \"\",//显宽\r\n      \"is_drag_zoom\": true,//是否拖拽缩放\r\n      \"grid\":{//网格样式\r\n        \"left\": 50,//左边距\r\n        \"top\": 40,//上边距\r\n        \"bottom\": 50,//下边距\r\n        \"right\": 40,//右边距\r\n        \"color\": \"#B7B7B7\",//网格线颜色\r\n        \"background\":\"transparent\",//网格背景色\r\n        \"width\": 1,//网格线宽度\r\n        \"xgrid_show\": true,//是否显示X轴网格线\r\n        \"xgrid_line_dash\":[],//X轴网格线虚线样式[5, 5]实，虚\r\n        \"ygrid_show\": true,//是否显示Y轴网格线\r\n        \"ygrid_line_dash\":[],//Y轴网格线虚线样式\r\n        \"center_line_show\": false,//是否显示中心线\r\n        \"center_color\": \"#FF0000\",//X轴中心线颜色\r\n        \"center_width\": 1 //X轴中心线宽度\r\n      },\r\n      \"legend\":{\r\n        \"visible\": false,//是否显示图例\r\n      },\r\n      \"xaxis\":{ //X轴样式\r\n        \"number\": 5,//X轴网格线数量\r\n        \"unit\":\"\",//单位MHz 为空不显示 \r\n        \"unit_two_line\": true, // x轴单位是否需要换行\r\n        \"unit_right\": 10, // x轴单位距离图表左侧距离\r\n        \"decimals\": \"\",//X轴刻度标签小数位数\r\n        \"dscan_freq\":[//DScan模式下的频率范围 [起始频率，结束频率] 传入多个范围时，则分段显示\r\n          // {\r\n          //   \"start_freq\": 0,//X轴起始频率\r\n          //   \"end_freq\": 0,//X轴结束频率\r\n          //   \"width\":1,//X轴线宽度 1多条时等比宽度\r\n          // }\r\n        ],\r\n        \"dscan_space\": 10,//DScan模式下的频段间隔像素\r\n        \"text_color\": \"#343434\",//X轴文本颜色\r\n        \"text_font_size\": 12,//X轴文本字体大小\r\n        \"text_font_family\": \"Arial\",//X轴文本字体\r\n        \"color\": \"#333\",//X轴线颜色\r\n        \"width\": 1,//X轴线宽度\r\n        \"labels\":[//*X轴刻度标签\r\n          [{\r\n              \"offsetx\": 0,//X轴刻度标签值\r\n              \"text\": 19,//X轴刻度标签\r\n            },\r\n            {\r\n              \"offsetx\": 30,//X轴刻度标签值\r\n              \"text\": 20,//X轴刻度标签\r\n            }\r\n          ]\r\n        ],\r\n        \"label_two_line\": true, // Dscan模式下分段数据第一个是否需要换行 \r\n        \"label_angle\":0,//*X轴刻度标签角度\r\n        \"draw_zoom_freq\":\"\",//*X轴绘制缩放基准频率\r\n        \"draw_zoom_span\":\"\",//*X轴绘制缩放基准显宽\r\n      },\r\n      \"yaxis\":{ //Y轴样式\r\n        \"number\": 5,//Y轴网格线数量\r\n        \"unit\":\"\",//单位 dBμV dBm dBμV/m 为空不显示 \r\n        \"decimals\": \"\",//X轴刻度标签小数位数\r\n        \"fixedStep\": 20,//Y轴刻度值间隔\r\n        \"init_min_value\": -30,//*Y轴最小值\r\n        \"init_max_value\": 60,//*Y轴最大值\r\n        \"min_value\": -30,//Y轴最小值\r\n        \"max_value\": 60,//Y轴最大值\r\n        \"floor_value\": -60,//Y轴最小值范围\r\n        \"ceiling_value\": 140,//Y轴最大值范围\r\n        \"text_color\": \"#343434\",//Y轴文本颜色\r\n        \"text_font_size\": 12,//Y轴文本字体大小\r\n        \"text_font_family\": \"Arial\",//Y轴文本字体\r\n        \"color\": \"#333\",//Y轴线颜色\r\n        \"width\": 1,//Y轴线宽度\r\n        \"axis_function\":function(value){\r\n          return value\r\n        },//Y轴刻度值计算函数\r\n        \"zoom_value\": \"\",//*Y轴缩放基准值\r\n        \"labels\":[],//*Y轴刻度标签\r\n      },\r\n      \"marker\":{ //marker样式\r\n        \"visible\": true,//是否显示marker\r\n        \"tip_show\": true,//是否显示提示框\r\n        \"freqdiff_show\": true,//是否显示频率差弹窗\r\n        \"is_add\": true,//是否可以添加marker\r\n        \"color\": \"#FF0000\",//marker颜色\r\n        \"width\": 1,//marker宽度\r\n        \"focus_color\": \"#FF0000\",//marker选中颜色\r\n        \"focus_width\": 1,//marker选中宽度\r\n        \"text_color\": \"#FFFFFF\",//提示框文本颜色\r\n        \"text_font_size\": 12,//提示框文本字体大小\r\n        \"text_font_family\": \"Arial\",//提示框文本字体\r\n        \"background\": \"#000000\",//提示框背景色\r\n        \"border_radius\": 6,//提示框圆角\r\n        \"difftext_color\": \"#FF0000\",//频率差框文本颜色\r\n        \"difftext_font_size\": 12,//频率差文本字体大小\r\n        \"difftext_font_family\": \"Arial\",//频率差文本字体\r\n        \"diff_background\": \"#000000\",//频率差背景色\r\n        \"diff_border_radius\": 6,//频率差圆角\r\n      },\r\n      \"threshold\":{ //门限样式\r\n        \"visible\": false,//是否显示门限\r\n        \"is_darg\":true,//是否可以拖拽门限\r\n        \"is_mouse\":false,//是否移动中\r\n        \"level\": 30,//门限强度值 dbuv\r\n        \"decimals\": 2,//门限值小数位数\r\n        \"color\": \"#19A9EB\",//门限线颜色\r\n        \"width\": 1,//门限线宽度\r\n        \"drag_color\": \"#3FFDB1\",//拖拽门限线颜色\r\n        \"drag_width\": 1,//拖拽门限线宽度\r\n        \"text_color\": \"#333\",//门限文本颜色\r\n        \"text_font_size\":12,//门限文本字体大小\r\n        \"drag_text_color\": \"#3FFDB1\",//拖拽门限文本颜色\r\n        \"drag_text_font_size\": 14,//拖拽门限文本字体大小\r\n        \"icon_url\":\"\",//门限图标\r\n        \"drag_icon_url\":\"\",//拖拽门限图标\r\n        \"icon_size\": [30,20],//门限图标大小\r\n      },\r\n      \"sptm_area\":{ //FFT频谱区域\r\n        \"visible\": false,//频谱是否显示区域\r\n        \"background\": \"ragb(0,0,0,0.5)\",//频谱区域背景色\r\n        \"drag_background\": \"ragb(0,0,0,0.5)\",//拖拽频谱区域背景色\r\n        \"start_freq\": 0,//频谱区域起始频率\r\n        \"end_freq\": 0,//频谱区域结束频率\r\n      },\r\n      \"level_tipline\":{//移动鼠标频谱值提示\r\n        \"visible\": false,//是否显示频谱值\r\n        \"freq_visible\":false,//是否显示频谱值频率\r\n        \"color\": \"#00afff\",//谱值提示线颜色\r\n        \"width\": 1,//谱值提示线宽度\r\n        \"text_color\": \"#333\",//谱值提示文本颜色\r\n        \"text_font_size\": 12,//谱值提示文本字体大小\r\n        \"is_draw\":false,//*是否绘制鼠标在网格区域内，有数据值\r\n        \"point\": {//*鼠标所在x轴坐标\r\n          \"pointx\": 0,//鼠标所在x轴坐标\r\n          \"pointy\": 0,//鼠标所在y轴坐标\r\n        },\r\n      }\r\n    }\r\n    const mergedOptions = deepMerge({}, defaultOptions);\r\n    this.options = deepMerge(mergedOptions,options);\r\n    //初始化参数和DPR计算\r\n    this.options.grid.left=Math.floor(this.options.grid.left*this.devicePixelRatio);\r\n    this.options.grid.bottom=Math.floor(this.options.grid.bottom*this.devicePixelRatio);\r\n    this.options.grid.top=Math.floor(this.options.grid.top*this.devicePixelRatio);\r\n    this.options.grid.right=Math.floor(this.options.grid.right*this.devicePixelRatio);\r\n    this.options.yaxis.init_min_value=this.options.yaxis.min_value\r\n    this.options.yaxis.init_max_value=this.options.yaxis.max_value\r\n    this.yLabelGridInfo={}//y轴标签网格信息\r\n    this.xLabelGridInfo=[]//x轴标签网格信息\r\n    \r\n    //if(this.options.yaxis.max_value-this.options.yaxis.min_value<=this.options.yaxis.fixedStep||){\r\n      this.options.yaxis.fixedStep=(this.options.yaxis.ceiling_value-this.options.yaxis.floor_value)/(this.options.yaxis.number-1)\r\n    //}\r\n    console.log(\"初始化配置\",this.options.yaxis.fixedStep)\r\n  }\r\n  init(){\r\n    this.clearCanvas();\r\n    this.initBackground();\r\n    this.drawAxis();\r\n    this.drawGrid();\r\n  }\r\n  /*\r\n   *初始化门限div\r\n  */\r\n  initthreshold(){\r\n    const thresholdDiv = document.createElement('div');\r\n    thresholdDiv.className = 'sptmchart_threshold';\r\n    thresholdDiv.style.position = 'absolute';\r\n    thresholdDiv.style.width = `${this.options.threshold.icon_size[0]*this.devicePixelRatio}px`;\r\n    thresholdDiv.style.height = `${this.options.threshold.icon_size[1]*this.devicePixelRatio}px`;\r\n    thresholdDiv.style.backgroundImage = `url(${this.options.threshold.icon_url})`;\r\n    thresholdDiv.style.backgroundSize = '100% 100%';\r\n    let iconLeft=this.options.grid.left-this.options.threshold.icon_size[0]*this.devicePixelRatio;\r\n    thresholdDiv.style.left = `${iconLeft}px`;\r\n    thresholdDiv.style.display = 'none';\r\n    this.canvas.parentNode.appendChild(thresholdDiv);\r\n    this.thresholdDiv = thresholdDiv;\r\n    this.thresholdDiv.addEventListener('mousedown', this.thresholdMousedown.bind(this));\r\n    this.thresholdDiv.addEventListener('mousemove', this.thresholdMousemove.bind(this));\r\n    this.thresholdDiv.addEventListener('mouseout', this.thresholdMouseout.bind(this));\r\n    this.thresholdDiv.addEventListener('mouseup', this.thresholdMouseout.bind(this));\r\n  }\r\n  initFredTip(){\r\n    const freqTip= document.createElement('span');\r\n    freqTip.className = 'sptmchart_freqtip';\r\n    freqTip.style.display = 'none';\r\n    freqTip.style.position = 'absolute';\r\n    freqTip.style.color=this.options.level_tipline.text_color;\r\n    freqTip.style.fontSize = `${this.options.level_tipline.text_size*this.devicePixelRatio}px`;\r\n    this.canvas.parentNode.appendChild(freqTip);\r\n    this.fretipDiv =freqTip\r\n  }\r\n  /**\r\n   *清空画布\r\n   */\r\n  clearCanvas(){\r\n    this.ctx.clearRect(0, 0, this.width, this.height);\r\n  }\r\n  /**\r\n   * 初始化背景\r\n   */\r\n  initBackground(){\r\n    this.ctx.fillStyle = this.options.background;\r\n    this.ctx.fillRect(0, 0, this.width, this.height);\r\n  }\r\n  /**\r\n   * 初始化图表\r\n   */\r\n  drawAxis(){\r\n    //计算x轴y轴坐标\r\n    this.cumputeLabels();\r\n    // 绘制x轴\r\n    this.ctx.strokeStyle = this.options.xaxis.color;\r\n    this.ctx.lineWidth = this.options.xaxis.width||1;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(this.options.grid.left, this.height - this.options.grid.bottom);\r\n    this.ctx.lineTo(this.width - this.options.grid.right, this.height - this.options.grid.bottom);\r\n    this.ctx.stroke();\r\n\r\n    // 绘制x轴标签\r\n    this.ctx.fillStyle = this.options.xaxis.text_color; \r\n    this.ctx.textBaseline = 'top';\r\n    this.ctx.font = `${this.options.xaxis.text_font_size*this.devicePixelRatio}px ${this.options.xaxis.text_font_family}`;\r\n    //const xLabelStep = (this.width - this.options.grid.left - this.options.grid.right) / (this.options.xaxis.labels.length - 1);\r\n    this.options.xaxis.labels.forEach((data, index) => {\r\n      for (let j = 0; j < data.length; j++) {\r\n        const items = data[j];\r\n        const texts = truncateNumber(items.text, this.options.xaxis.decimals);\r\n        let angleInRadians = this.options.xaxis.label_angle * Math.PI / 180; // 将角度转换为弧度\r\n\r\n        var x = this.options.grid.left + items.offsetx ;\r\n        var y = this.height - this.options.grid.bottom + 8;\r\n\r\n        if (this.options.xaxis.label_two_line) {\r\n          this.ctx.textAlign = 'center';\r\n          // 第一个点错位\r\n          if (index > 0 && j == 0) {\r\n            y = this.height - this.options.grid.bottom + this.options.grid.bottom / 2;\r\n          }\r\n          this.ctx.fillText(texts, x, y); // 绘制文字\r\n        } else {\r\n          if (this.options.xaxis.label_angle > 0) {\r\n            this.ctx.save(); // 保存当前绘图状态\r\n            this.ctx.translate(x, y); // 原点移动到移动到标签位置\r\n            this.ctx.rotate(angleInRadians); // 应用旋转变换\r\n            this.ctx.fillText(texts, 0, 0); // 绘制旋转后的文字\r\n            this.ctx.restore(); // 恢复上下文状态\r\n          } else {\r\n            this.ctx.textAlign = 'center';\r\n            let halfWidth = this.ctx.measureText(texts).width / 2\r\n\r\n            if (j === data.length - 1 && index < this.options.xaxis.labels.length - 1) {\r\n              x = this.options.grid.left + items.offsetx - halfWidth;\r\n            }\r\n            if (index > 0 && j == 0) {\r\n              x = this.options.grid.left + items.offsetx + halfWidth;\r\n            }\r\n            this.ctx.fillText(texts, x, y); // 绘制文字\r\n          }\r\n        } \r\n      }\r\n    });\r\n\r\n    //绘制X轴单位\r\n    if(this.options.xaxis.unit!==\"\"){\r\n      if(this.options.xaxis.unit_two_line){\r\n        this.ctx.fillText(this.options.xaxis.unit, this.width-this.options.grid.right-4, this.height - this.options.grid.bottom + this.options.grid.bottom/2);\r\n      }else{\r\n        this.ctx.fillText(this.options.xaxis.unit, this.width-this.options.grid.right+this.options.xaxis.unit_right, this.height - this.options.grid.bottom + 8);\r\n      }\r\n    }\r\n    // 绘制y轴\r\n    this.ctx.strokeStyle = this.options.yaxis.color;\r\n    this.ctx.lineWidth = this.options.yaxis.width||1;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(this.options.grid.left, this.options.grid.top);\r\n    this.ctx.lineTo(this.options.grid.left, this.height - this.options.grid.bottom);\r\n    this.ctx.stroke();\r\n\r\n    // 绘制y轴标签\r\n    this.ctx.fillStyle = this.options.yaxis.text_color||'#343434';\r\n    this.ctx.textAlign = 'right';\r\n    this.ctx.textBaseline = 'middle';\r\n    this.ctx.font = `${this.options.yaxis.text_font_size*this.devicePixelRatio}px ${this.options.yaxis.text_font_family}`;\r\n    this.options.yaxis.labels.forEach((label, index) => {\r\n      const y = this.height - this.options.grid.bottom - label.offsetY;\r\n      const centtext=this.options.yaxis.axis_function(label.text)\r\n      const texts=truncateNumber(centtext,this.options.yaxis.decimals);\r\n      this.ctx.fillText(texts, this.options.grid.left - 5, y);\r\n    });\r\n    //绘制Y轴单位\r\n    if(this.options.yaxis.unit!==\"\"){\r\n      this.ctx.fillText(this.options.yaxis.unit, this.options.grid.left - 5, this.options.grid.top/2);\r\n    }\r\n    \r\n  }\r\n  /**\r\n   * 绘制图例\r\n   */\r\n  drawLegend() {\r\n    const { grid, legend } = this.options;\r\n    if(!legend.visible)return false;\r\n    // 计算每个标签的宽度并累加\r\n    const legendItems = this.tracesData.map((data, index) => {\r\n        if(data.visible){\r\n          const label = data.name || `数据 ${index + 1}`;\r\n          const color=data.color;\r\n          const width = this.ctx.measureText(label).width + 20; // 加上间距\r\n          return { label, width ,color};\r\n        }\r\n    });\r\n\r\n    // 计算总宽度\r\n\r\n    const totalLegendWidth = legendItems.reduce((sum, item) => sum + item.width + 15, 0)-20; // 15是方块宽度加间距\r\n\r\n    // 设置图例的X坐标，确保水平居中\r\n    const legendX = (this.width - totalLegendWidth) / 2;\r\n\r\n    const legendY = grid.top/2;\r\n\r\n    this.ctx.fillStyle = legend.color;\r\n\r\n    // 绘制每个数据集的图例\r\n    let currentX = legendX; // 当前X坐标，用于排列图例\r\n    legendItems.forEach((item, index) => {\r\n        this.ctx.fillStyle = item.color;\r\n        this.ctx.fillRect(currentX, legendY-5, 10, 10); // 绘制颜色方块\r\n        this.ctx.fillStyle = legend.color;\r\n        this.ctx.textAlign = 'left';\r\n        this.ctx.fillText(item.label, currentX + 20, legendY); // 绘制标签\r\n        currentX += item.width+15; // 更新当前X坐标\r\n    });\r\n  }\r\n  /**\r\n   * 绘制网格\r\n   */\r\n  drawGrid(){\r\n    this.ctx.fillStyle = this.options.grid.background;\r\n    this.ctx.fillRect(this.options.grid.left, this.options.grid.top, this.chartWidth, this.chartHeight);\r\n    this.ctx.strokeStyle = this.options.grid.color;\r\n    this.ctx.lineWidth =  this.options.grid.width;\r\n    this.ctx.setLineDash(this.options.grid.ygrid_line_dash);\r\n    // 绘制网格Y轴线\r\n    if(this.options.grid.ygrid_show&&this.options.xaxis.labels.length>0){\r\n      \r\n      this.options.xaxis.labels.forEach((data,indexs)=>{\r\n        for (let index = 0; index < data.length; index++) {\r\n          let colors=this.options.grid.color\r\n          if(this.options.xaxis.labels.length>1&&indexs==0&&index==(data.length-1)){\r\n            colors=\"green\"\r\n          }else if(this.options.xaxis.labels.length>1&&indexs>0&&(index==0||index==(data.length-1))){\r\n            colors=\"green\"\r\n          }\r\n          this.ctx.beginPath();\r\n          this.ctx.strokeStyle = colors;\r\n          const items = data[index];\r\n          this.ctx.moveTo(this.options.grid.left+items.offsetx, this.options.grid.top);\r\n          this.ctx.lineTo(this.options.grid.left+items.offsetx, this.height - this.options.grid.bottom);\r\n          this.ctx.stroke();\r\n        }\r\n      })\r\n    }\r\n    // 绘制网格x轴线\r\n    const gridLength = this.yLabelGridInfo.gridLabels.length\r\n    this.ctx.strokeStyle = this.options.grid.color;\r\n    this.ctx.setLineDash(this.options.grid.xgrid_line_dash);\r\n    this.ctx.beginPath();\r\n    if(this.options.grid.xgrid_show&&gridLength>0){\r\n      \r\n      for (let j = 0; j <= gridLength; j ++) {\r\n        let items=this.yLabelGridInfo.gridLabels[j];\r\n        let y=(items-this.options.yaxis.min_value)*this.yLabelGridInfo.pxStep\r\n        this.ctx.moveTo(this.options.grid.left, this.height - this.options.grid.bottom - y);\r\n        this.ctx.lineTo(this.width - this.options.grid.right, this.height - this.options.grid.bottom - y);\r\n        this.ctx.stroke();\r\n      }\r\n    }\r\n    //恢复线样式\r\n    this.ctx.setLineDash([]);\r\n    if(this.options.grid.center_line_show){\r\n      //y中心线\r\n      this.ctx.strokeStyle = this.options.grid.center_color;\r\n      this.ctx.lineWidth = this.options.grid.center_width;\r\n      this.ctx.beginPath();\r\n      this.ctx.moveTo(this.options.grid.left+this.chartWidth/2, this.options.grid.top);\r\n      this.ctx.lineTo(this.options.grid.left+this.chartWidth/2, this.height - this.options.grid.bottom);\r\n      this.ctx.stroke();\r\n    }\r\n    \r\n  }\r\n  /**\r\n   * 绘制画布\r\n  */\r\n  draw(){\r\n    this.clearCanvas();\r\n    this.drawAxis();\r\n    this.drawGrid();\r\n    this.drawLegend();\r\n    this.drawTraces();\r\n    this.drawOther();\r\n  }\r\n  /**\r\n   * 绘制图表\r\n   */\r\n  drawChart(){\r\n    if(this.refreshInterval){\r\n      clearInterval(this.refreshInterval);\r\n      this.refreshInterval=null;\r\n    }\r\n    if(this.options.duration&&this.options.duration>0&&this.isDraw){\r\n      this.refreshInterval=setInterval(()=>{\r\n        this.draw();\r\n      },this.options.duration)\r\n    }else{\r\n      this.draw();\r\n    }\r\n  }\r\n  /**\r\n   * 绘制门限\r\n   */\r\n  drawThreshold(){\r\n    if(this.options.threshold.visible){\r\n      //门限线\r\n      \r\n      let colors=this.options.threshold.color;\r\n      let widhts=this.options.threshold.width;\r\n      if(this.options.threshold.is_mouse||this.thresholdFouce){\r\n        colors=this.options.threshold.drag_color;\r\n        widhts=this.options.threshold.drag_width;\r\n        this.thresholdDiv.style.cursor = 'pointer';\r\n        this.thresholdDiv.style.backgroundImage = `url(${this.options.threshold.drag_icon_url})`;\r\n      }else{\r\n        this.thresholdDiv.style.cursor = 'default';\r\n        this.thresholdDiv.style.backgroundImage = `url(${this.options.threshold.icon_url})`;\r\n      }\r\n      this.ctx.strokeStyle = colors;\r\n      this.ctx.lineWidth = widhts;\r\n      this.ctx.beginPath();\r\n      let y=this.height - this.options.grid.bottom - ((this.options.threshold.level - this.options.yaxis.min_value) /(this.options.yaxis.max_value - this.options.yaxis.min_value)) * this.chartHeight;\r\n      if(y<this.options.grid.top){\r\n        y=this.options.grid.top;\r\n      }\r\n      if(y>this.height-this.options.grid.bottom){\r\n        y=this.height-this.options.grid.bottom;\r\n      }\r\n      const centtext=this.options.yaxis.axis_function(this.options.threshold.level)\r\n      const texts=truncateNumber(centtext,this.options.threshold.decimals);\r\n      let labeltext=\"门限:\"+texts+this.options.yaxis.unit;\r\n      this.ctx.moveTo(this.options.grid.left, y);\r\n      this.ctx.lineTo(this.width-this.options.grid.right, y);\r\n      this.ctx.stroke();\r\n      const textwidth=this.ctx.measureText(labeltext).width+20;\r\n      this.ctx.fillStyle = \"rgba(0,0,0,0.4)\";\r\n      this.ctx.fillRect( this.options.grid.left+this.chartWidth/3-10, y-34, textwidth, 24);\r\n      this.ctx.fillStyle = colors;\r\n      this.ctx.textAlign = 'left';\r\n      this.ctx.font=`${this.options.threshold.text_font_size*this.devicePixelRatio}px Arial`\r\n      this.ctx.textBaseline = 'middle';\r\n      \r\n      this.ctx.fillText(labeltext, this.options.grid.left+this.chartWidth/3, y-20);\r\n      //门限图标位置\r\n      this.thresholdDiv.style.display = 'block';\r\n      let iconTop=y-this.options.threshold.icon_size[1]/2;\r\n      this.thresholdDiv.style.top = `${iconTop}px`;\r\n    }else{\r\n      this.thresholdDiv.style.display = 'none';\r\n    }\r\n  }\r\n  /**\r\n   * 绘制提示线\r\n   */\r\n  drawTipLine(){\r\n    if(this.options.level_tipline.visible&&this.options.level_tipline.point.pointx&&this.tracesData.length>0){\r\n      let point=this.options.level_tipline.point\r\n      let mouselevel=this.getMousePositionLevel(point)\r\n\r\n      if(mouselevel.y.length>0){\r\n        this.options.level_tipline.is_draw=true;\r\n        let colors=this.options.level_tipline.color;\r\n        let widhts=this.options.level_tipline.width;\r\n        this.ctx.strokeStyle = colors;\r\n        this.ctx.lineWidth = widhts;\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(point.pointx,this.options.grid.top);\r\n        this.ctx.lineTo(point.pointx, this.height-this.options.grid.bottom);\r\n        this.ctx.stroke();\r\n        this.tipFreqLevel(mouselevel)\r\n      }else{\r\n        this.options.level_tipline.is_draw=false;\r\n        this.fretipDiv.style.display=\"none\";\r\n      }\r\n      \r\n    }else{\r\n      this.options.level_tipline.is_draw=false;\r\n      this.fretipDiv.style.display=\"none\";\r\n    }\r\n  }\r\n  drawOther(){\r\n    //绘制门限\r\n    this.drawThreshold();\r\n    //绘制提示线\r\n    this.drawTipLine();\r\n  }\r\n  /**\r\n   *停止绘制\r\n   */\r\n  stopChart(){\r\n    this.isDraw=false;\r\n    if(this.refreshInterval){\r\n      clearInterval(this.refreshInterval);\r\n      this.refreshInterval=null;\r\n    }\r\n  }\r\n  /**\r\n   * 绘制谱线\r\n   */\r\n  drawTraces(){\r\n    for (let i = 0; i < this.tracesData.length; i++) {\r\n      if (this.tracesData[i].datainfo.length>0&&this.tracesData[i].visible) {\r\n        let linedata=this.tracesData[i].datainfo\r\n        for (let j = 0; j < linedata.length; j++) {\r\n          this.drawTypeLine(this.tracesData[i],j);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 判断绘制图表线类型\r\n   * @param {*} datas \r\n   */\r\n  drawTypeLine(lineData,order){\r\n    //console.log(\"绘制谱线数据\",lineData)\r\n    let data=lineData.datainfo[order]\r\n    data.width=lineData.width\r\n    data.color=lineData.color\r\n    data.type=lineData.type\r\n    data.drawData=data.data.slice(0);\r\n    data.order=order//数据序号\r\n    //X轴标签网格信息\r\n    let labelInfo=this.xLabelGridInfo[data.order]\r\n    let drawWidth=labelInfo.width\r\n\r\n    //截取区域内点数\r\n    if(labelInfo.start_freq!==labelInfo.show_start_freq||labelInfo.end_freq!==labelInfo.show_end_freq){\r\n      //需要截取数据\r\n      // let startOrder=Math.floor((labelInfo.show_start_freq-labelInfo.start_freq)*(labelInfo.end_freq-labelInfo.start_freq)/data.point)\r\n      // let endOrder=Math.floor((labelInfo.show_end_freq-labelInfo.start_freq)*(labelInfo.end_freq-labelInfo.start_freq)/data.point)\r\n      let startOrder=Math.floor((labelInfo.show_start_freq-labelInfo.start_freq)*data.point/(labelInfo.end_freq-labelInfo.start_freq))\r\n      let endOrder=Math.floor((labelInfo.show_end_freq-labelInfo.start_freq)*data.point/(labelInfo.end_freq-labelInfo.start_freq))\r\n      data.drawData=data.data.slice(startOrder,endOrder)\r\n    }\r\n    if(data.drawData.length>drawWidth){\r\n      //数据过多抽点\r\n      let type=\"maxmin\"\r\n      let pointdata=\"\"\r\n      if(type==\"maxmin\"){\r\n        data.lineType='pointline'\r\n        pointdata=this.extractTwoPolesTraceLine(data.data,data.data.length,drawWidth)\r\n        data.drawData=pointdata\r\n        //this.drawPointLineTrace(data)\r\n      }else{\r\n        data.lineType='line'\r\n        pointdata=this.extractTraceData(data.data,data.data.length,drawWidth)\r\n        data.drawData=pointdata\r\n        //this.drawLineTrace(data)\r\n      }\r\n    }else if(data.drawData.length==drawWidth){\r\n      data.lineType='line'\r\n      data.drawData=data.data\r\n      //this.drawLineTrace(data)\r\n    }else{\r\n      data.lineType='step'\r\n      //this.drawStepTrace(data)\r\n    }\r\n    this.drawLine(data)\r\n  }\r\n  /**\r\n   * 绘制线\r\n   * @param {*} datas 谱线数据\r\n   */\r\n  drawLine(data){\r\n    this.ctx.save();\r\n    this.ctx.beginPath();\r\n    this.ctx.rect(\r\n        this.options.grid.left,\r\n        this.options.grid.top,\r\n        this.chartWidth,\r\n        this.chartHeight\r\n    );\r\n    // 裁剪谱线超过图表区域的部分\r\n    this.ctx.clip(); \r\n    this.ctx.beginPath();\r\n    this.ctx.strokeStyle = data.color;\r\n    this.ctx.lineWidth = data.width || 1;\r\n    let linedata=data.drawData\r\n    if(data.lineType=='pointline'){\r\n      linedata=data.drawData.targetData\r\n    }\r\n    //X轴标签网格信息\r\n    let labelInfo=this.xLabelGridInfo[data.order]\r\n    //console.log(\"绘制线\",data,labelInfo)\r\n    let drawStepPx=labelInfo.width/(linedata.length-1)\r\n    // if(data.lineType=='step'){\r\n    //   drawStepPx=labelInfo.width/(linedata.length-1)\r\n    // }\r\n    \r\n    //数据不完整\r\n    // if(data.point>data.data.length){\r\n      \r\n    //   let drawWidth=data.data.length/data.point*labelInfo.width\r\n    //   drawStepPx=drawWidth/(linedata.length-1)\r\n    // }\r\n    //更新当前绘制点间隔像素\r\n    labelInfo.drawStepPx=drawStepPx;\r\n    labelInfo.lineType=data.lineType\r\n    if(data.lineType=='line'){\r\n      //线性\r\n      for (let i = 0; i < linedata.length; i++) {\r\n        let point = linedata[i];\r\n        let startPointPx=labelInfo.start_x;\r\n        let startx=this.options.grid.left+startPointPx;\r\n        let x = startx + i * drawStepPx;\r\n        if(x>this.width-this.options.grid.right||x<this.options.grid.left){\r\n          break;\r\n        }\r\n        let y = this.height - this.options.grid.bottom - ((point - this.options.yaxis.min_value) /(this.options.yaxis.max_value - this.options.yaxis.min_value)) * this.chartHeight;\r\n        // if(y>(this.height -this.options.grid.bottom)){\r\n        //   y=this.height -this.options.grid.bottom\r\n        // }\r\n        // if(y<this.options.grid.top){\r\n        //   y=this.options.grid.top\r\n        // }\r\n        if(i==0){\r\n          this.ctx.moveTo(x, y);\r\n        }else{\r\n          this.ctx.lineTo(x, y);\r\n        }\r\n      }\r\n    }else if(data.lineType=='step'){\r\n      //步进线\r\n      for (let j = 0; j < data.drawData.length; j++) {\r\n        let point = data.drawData[j];\r\n        let startPointPx=labelInfo.start_x;\r\n        let startx=this.options.grid.left+startPointPx;\r\n        //第一个点一半\r\n        let x1 = startx + j * drawStepPx-drawStepPx/2;\r\n        let x2 = startx+ j * drawStepPx+drawStepPx/2;\r\n        // let x1 = startx + j * drawStepPx;\r\n        // let x2 = startx+ j * drawStepPx+drawStepPx;\r\n        if(x1<this.options.grid.left){\r\n          x1=this.options.grid.left;\r\n        }\r\n        if(x2>(this.width-this.options.grid.right)){\r\n          x2=this.width-this.options.grid.right\r\n        }\r\n        let y = this.height - this.options.grid.bottom - ((point - this.options.yaxis.min_value) /(this.options.yaxis.max_value - this.options.yaxis.min_value)) * this.chartHeight;\r\n        // if(y>(this.height -this.options.grid.bottom)){\r\n        //   y=this.height -this.options.grid.bottom\r\n        // }\r\n        // if(y<this.options.grid.top){\r\n        //   y=this.options.grid.top\r\n        // }\r\n        \r\n        if(j==0){\r\n          this.ctx.moveTo(startx, y);\r\n          this.ctx.lineTo(x2, y);\r\n        }else{\r\n          // 先水平线到下一个 x，再垂直线到下一个 y\r\n          this.ctx.lineTo(x1, y); // 水平线\r\n          this.ctx.lineTo(x2, y); // 垂直线\r\n        }\r\n      }\r\n    }else if(data.lineType=='pointline'){\r\n      //大小点线\r\n      for (let i = 0; i < linedata.length; i++) {\r\n        let point = linedata[i][0];\r\n        let minpoint = linedata[i][1];\r\n        let startPointPx=labelInfo.start_x;\r\n        let startx=this.options.grid.left+startPointPx;\r\n        let x = startx+ i * drawStepPx;\r\n        if(x>this.width-this.options.grid.right||x<this.options.grid.left){\r\n          break;\r\n        }\r\n        let y = this.height - this.options.grid.bottom - ((point - this.options.yaxis.min_value) /(this.options.yaxis.max_value - this.options.yaxis.min_value)) * this.chartHeight;\r\n        let y1 = this.height - this.options.grid.bottom - ((minpoint - this.options.yaxis.min_value) /(this.options.yaxis.max_value - this.options.yaxis.min_value)) * this.chartHeight;\r\n        \r\n        // if(y>(this.height -this.options.grid.bottom)){\r\n        //   y=this.height -this.options.grid.bottom\r\n        // }\r\n        // if(y<this.options.grid.top){\r\n        //   y=this.options.grid.top\r\n        // }\r\n        // if(y1>(this.height -this.options.grid.bottom)){\r\n        //   y1=this.height -this.options.grid.bottom\r\n        // }\r\n        // if(y1<this.options.grid.top){\r\n        //   y1=this.options.grid.top\r\n        // }\r\n        if(i==0){\r\n          this.ctx.moveTo(x, y);\r\n          this.ctx.lineTo(x, y1);\r\n        }else{\r\n          this.ctx.lineTo(x, y);\r\n          this.ctx.lineTo(x, y1);\r\n        }\r\n      }\r\n    }\r\n    \r\n    this.ctx.stroke();\r\n    this.ctx.restore();\r\n\r\n    \r\n  }\r\n  \r\n  /**\r\n   * 添加谱线\r\n   */\r\n  addTrace(option){\r\n    let defaultOption={\r\n      \"id\":1,\r\n      \"type\":\"FFT\",\r\n      \"visible\":true,\r\n      \"point\":100,\r\n      \"name\":\"\",\r\n      \"color\":\"#000\",\r\n      \"datainfo\":[],\r\n      \"width\":1\r\n    }\r\n    const options = deepMerge(defaultOption, option);\r\n    this.tracesData.push(options);\r\n    this.isDraw=true\r\n    this.drawChart();\r\n  }\r\n  /**\r\n   * 设置谱线数据\r\n   * @param {*} id 谱线id\r\n   * @param {*} data 谱线数据\r\n   */\r\n  \r\n  setTraceData(id,data){\r\n    for (let i = 0; i < this.tracesData.length; i++) {\r\n      if (this.tracesData[i].id === id) {\r\n        this.tracesData[i].datainfo=data;\r\n        break;\r\n      }\r\n    }\r\n    this.isDraw=true\r\n    this.drawChart();\r\n  }\r\n  /**\r\n   * 设置单频谱线数据\r\n   * @param {*} id \r\n   * @param {*} dataInfo \r\n   */\r\n  setFFTTraceData(id,dataInfo){\r\n    for (let i = 0; i < this.tracesData.length; i++) {\r\n      if (this.tracesData[i].id === id) {\r\n        this.tracesData[i].datainfo=dataInfo;\r\n        break;\r\n      }\r\n    }\r\n    this.isDraw=true\r\n    this.drawChart();\r\n  }\r\n  /**\r\n   * 设置频段谱线数据\r\n   * @param {*} id \r\n   * @param {*} dataInfo \r\n   */\r\n  setDScanTraceData(id,dataInfo){\r\n    for (let i = 0; i < this.tracesData.length; i++) {\r\n      if (this.tracesData[i].id === id) {\r\n        this.tracesData[i].datainfo=dataInfo;\r\n        break;\r\n      }\r\n    }\r\n    this.drawChart();\r\n  }\r\n  /**\r\n   * 计算标签\r\n   */\r\n  cumputeLabels(){\r\n    this.options.xaxis.labels=[];\r\n    this.options.yaxis.labels=[];\r\n    \r\n    //计算图表宽高\r\n    this.chartWidth=Math.floor(this.width - this.options.grid.left - this.options.grid.right)\r\n    this.chartHeight=Math.floor(this.height - this.options.grid.top - this.options.grid.bottom)\r\n    //计算网格步进\r\n    const yWidth=this.chartHeight/(this.options.yaxis.number-1);\r\n    const yStepLabels=calculateStepValues(yWidth,this.options.yaxis.min_value,this.options.yaxis.max_value,this.options.yaxis.fixedStep,this.yZoom,this.options.yaxis.floor_value,this.options.yaxis.ceiling_value,this.options.yaxis.number);\r\n    this.yLabelGridInfo=yStepLabels;\r\n    //更新Y轴范围\r\n    this.options.yaxis.min_value=yStepLabels.minValue;\r\n    this.options.yaxis.max_value=yStepLabels.maxValue;\r\n    console.log(\"cumputeLabels计算y轴\",this.options.yaxis.max_value,this.options.yaxis.min_value)\r\n    this.options.grid.right = this.width - this.options.grid.left - this.chartWidth;\r\n    this.options.grid.bottom = this.height - this.options.grid.top - this.chartHeight;\r\n    this.ygridStep=yStepLabels.labelStep\r\n    if(this.options.type==\"DScan\"){\r\n      //一条频段\r\n      let xCoutWidth=[this.chartWidth];\r\n      let dscan_freq=this.options.xaxis.dscan_freq\r\n      let dscan_space=this.options.xaxis.dscan_space\r\n      let drawArray=[]//x轴标签\r\n      \r\n      //计算起始点\r\n      let startPointPx=0;\r\n      let widths=[]\r\n      for(let j=0;j<dscan_freq.length;j++){\r\n        let itemdata=dscan_freq[j];\r\n        widths.push(itemdata.width)\r\n      }\r\n      //计算宽度\r\n      let widthVal=calculateWidths(this.chartWidth,widths,dscan_space)\r\n      xCoutWidth=widthVal.widths;\r\n      for(let i=0;i<dscan_freq.length;i++){\r\n        let itemdata=dscan_freq[i];\r\n        let datastartFreq=itemdata.start_freq;\r\n        let dataendFreq=itemdata.end_freq;\r\n        let datacenterFreq=datastartFreq+(dataendFreq-datastartFreq)/2;\r\n        let dataspan=dataendFreq-datastartFreq;\r\n        //初始\r\n        let centerFreq=datacenterFreq\r\n        let span=dataspan\r\n        let zoom=1;\r\n        if(this.xLabelGridInfo.length>0){\r\n          let drawInfo=this.xLabelGridInfo[i]\r\n          if(drawInfo.draw_zoom_freq!==\"\"){\r\n            centerFreq=drawInfo.draw_zoom_freq\r\n          }\r\n          if(drawInfo.draw_zoom!==\"\"){\r\n            zoom=drawInfo.draw_zoom\r\n          }\r\n        }\r\n\r\n        //缩放显宽\r\n        let xspan=Math.floor(span/zoom/2)*2;\r\n        let startFreq=centerFreq-xspan/2\r\n        let endFreq=startFreq+xspan\r\n        let labelCout= this.options.xaxis.number\r\n        let freqStep=xspan/(labelCout-1)\r\n        let labelStepPx=xCoutWidth[i]/(labelCout-1)\r\n\r\n        if(startFreq&&freqStep){\r\n          let labels=[];\r\n          \r\n          for(let j=0;j<labelCout;j++){\r\n            var xVal=startFreq+j*freqStep;\r\n            let labelObj={\r\n              \"text\":xVal/1000000,\r\n              \"offsetx\":startPointPx+labelStepPx*j\r\n            };\r\n            labels.push(labelObj);\r\n          }\r\n          this.options.xaxis.labels.push(labels);\r\n        }\r\n        let drawAxis={\r\n          \"start_freq\": datastartFreq,//X轴起始频率\r\n          \"end_freq\": dataendFreq,//X轴结束频率\r\n          \"width\":xCoutWidth[i],//X轴绘制宽度\r\n          \"span\":dataspan,//当前显示显宽\r\n          \"freqStep\":freqStep,//*X轴频率刻度间隔\r\n          \"labelStepPx\":labelStepPx,//X轴label间隔像素\r\n          \"show_start_freq\":startFreq,//显示起始频率\r\n          \"show_end_freq\":endFreq,//显示结束频率\r\n          \"start_x\":startPointPx,//*X轴起始位置\r\n          \"end_x\":startPointPx+xCoutWidth[i],//*X轴结束位置\r\n          \"drawStepPx\":\"\",//*X轴当前绘制点间隔像素\r\n          \"draw_zoom\":zoom,//*缩放层级\r\n          \"draw_zoom_freq\":centerFreq,//*缩放位置的频率\r\n          \"draw_zoom_span\":xspan//*缩放时显宽\r\n        }\r\n        drawArray.push(drawAxis)\r\n        //增加初始位置\r\n        startPointPx+=(xCoutWidth[i]+widthVal.spacing)\r\n      }\r\n      this.xLabelGridInfo=drawArray\r\n    }else{\r\n      //单频\r\n      let zoom=1;\r\n      if(this.options.center_freq!==\"\"&&this.options.span!==\"\"){\r\n        let centerFreq=this.options.center_freq;\r\n        let span=this.options.span;\r\n        if(this.xLabelGridInfo.length>0){\r\n          let drawInfo=this.xLabelGridInfo[0]\r\n          if(drawInfo.draw_zoom_freq!==\"\"){\r\n            centerFreq=drawInfo.draw_zoom_freq\r\n          }\r\n          if(drawInfo.draw_zoom!==\"\"){\r\n            zoom=drawInfo.draw_zoom\r\n          }\r\n        }\r\n        \r\n        //缩放显宽\r\n        let xspan=Math.floor(span/zoom/2)*2;\r\n        let startFreq=centerFreq-xspan/2\r\n        let endFreq=startFreq+xspan\r\n        let labelCout=this.options.xaxis.number\r\n        let freqStep=xspan/(labelCout-1)\r\n        let labelStepPx=this.chartWidth/(labelCout-1)\r\n        if(startFreq&&freqStep){\r\n          let labels=[];\r\n          for(let j=0;j<this.options.xaxis.number;j++){\r\n            var xVal=startFreq+j*freqStep;\r\n            let labelObj={\r\n              \"text\":xVal/1000000,\r\n              \"offsetx\":labelStepPx*j\r\n            };\r\n            labels.push(labelObj);\r\n          }\r\n          this.options.xaxis.labels.push(labels);\r\n        }\r\n        let drawAxis={\r\n          \"start_freq\": this.options.center_freq-this.options.span/2,//X轴初始起始频率\r\n          \"end_freq\": this.options.center_freq+this.options.span/2,//X轴初始结束频率\r\n          \"width\":this.chartWidth,//X轴绘制宽度\r\n          \"span\":this.options.span,//初始显宽\r\n          \"freqStep\":freqStep,//*X轴频率刻度间隔\r\n          \"labelStepPx\":labelStepPx,//X轴label间隔像素\r\n          \"show_start_freq\":startFreq,//显示起始频率\r\n          \"show_end_freq\":endFreq,//显示结束频率\r\n          \"start_x\":0,//*X轴起始位置\r\n          \"end_x\":this.chartWidth,//*X轴结束位置\r\n          \"drawStepPx\":\"\",//*X轴当前绘制点间隔像素\r\n          \"draw_zoom\":zoom,//*缩放层级\r\n          \"draw_zoom_freq\":centerFreq,//*缩放位置的频率\r\n          \"draw_zoom_span\":xspan//*缩放时显宽\r\n        }\r\n        this.xLabelGridInfo=[drawAxis]\r\n      }\r\n    }\r\n    \r\n    if(this.options.yaxis.min_value!==\"\"){\r\n      if(this.options.yaxis.zoom_value==\"\"){\r\n        this.options.yaxis.init_min_value=this.options.yaxis.min_value;\r\n        this.options.yaxis.init_max_value=this.options.yaxis.max_value;\r\n        this.options.yaxis.zoom_value=this.options.yaxis.min_value+(this.options.yaxis.max_value-this.options.yaxis.min_value)/2;\r\n      }\r\n      for(var i=0;i<yStepLabels.labels.length;i++){\r\n        let yVal=yStepLabels.labels[i]\r\n        let labelObj={\r\n          \"text\":yVal,\r\n          \"offsetY\":(yVal-this.options.yaxis.min_value)*yStepLabels.pxStep\r\n        };\r\n        this.options.yaxis.labels.push(labelObj);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 频谱源数据索引值（映射区最右侧点，抽取最大值）\r\n   * @param {*} dataLen 源数据长度\r\n   * @param {*} targetIndex 目标索引值\r\n   * @param {*} targetLen 目标长度\r\n   */\r\n  selectDataIndex(dataLen,targetIndex,targetLen){\r\n    if(targetIndex>=dataLen||dataLen==0||targetLen==0){\r\n      return 0\r\n    }\r\n    if(targetLen==1){\r\n      return Math.floor(dataLen/2)\r\n    }else if(targetLen==dataLen){\r\n      return targetIndex\r\n    }else if(dataLen>targetLen){\r\n      //源数据长度大于目标长度，则取源数据映射区\r\n      let order=Math.floor((targetIndex+1)*dataLen/targetLen)-1\r\n      return order\r\n    }else{\r\n      //源数据长度小于目标长度\r\n      let order=Math.floor(targetIndex*dataLen/targetLen)\r\n      return order\r\n    }\r\n  }\r\n  /**\r\n   * 谱线最大点抽点\r\n   * @param {*} data 源数据\r\n   * @param {*} dataLen 源数据长度\r\n   * @param {*} targetLen 目标长度\r\n   * @return\r\n   */\r\n  extractTraceData(data,dataLen,targetLen){\r\n    let targetData=[];//目标数据\r\n    let dataIndex=[];//源数据索引值\r\n    let selectIndex=0;//抽取索引值\r\n      //抽点最大值\r\n      let targetCout=0;\r\n      selectIndex=this.selectDataIndex(dataLen,targetCout,targetLen)\r\n      let isMaxSelected=false;\r\n      let maxValue=0;\r\n      let maxIndex=-1;\r\n      for(let j=0;j<dataLen;j++){\r\n        if(isMaxSelected){\r\n          if(data[j]>maxValue){\r\n            maxValue=data[j];\r\n            maxIndex=j;\r\n          }\r\n        }else{\r\n          maxValue=data[j];\r\n          maxIndex=j;\r\n          isMaxSelected=true;\r\n        }\r\n        if(selectIndex==j){\r\n          //找到抽取索引值\r\n          targetData[targetCout]=maxValue;\r\n          dataIndex[targetCout]=maxIndex;\r\n          targetCout++;\r\n          isMaxSelected=false;\r\n          selectIndex=this.selectDataIndex(dataLen,targetCout,targetLen)\r\n        }\r\n      }\r\n    \r\n    return {\r\n      targetData,\r\n      dataIndex\r\n    }\r\n  }\r\n  /**\r\n   * 保留最大最小方式抽点\r\n   * @param {*} data 源数据长度\r\n   * @param {*} dataLen 源数据长度\r\n   * @param {*} targetLen 目标长度\r\n   */\r\n  extractTwoPolesTraceLine(data,dataLen,targetLen){\r\n    let targetData=[];//目标数据\r\n    let dataIndex=[];//源数据索引值\r\n    let selectIndex=0;//抽取索引值\r\n      //抽点最大值\r\n      let targetCout=0;\r\n      selectIndex=this.selectDataIndex(dataLen,targetCout,targetLen)\r\n      let isMaxSelected=false;\r\n      let maxValue=0;\r\n      let minValue=0;\r\n      let minIndex=-1;\r\n      let maxIndex=-1;\r\n      for(let j=0;j<dataLen;j++){\r\n        if(isMaxSelected){\r\n          if(data[j]>maxValue){\r\n            maxValue=data[j];\r\n            maxIndex=j;\r\n          }\r\n          if(data[j]<minValue){\r\n            minValue=data[j];\r\n            minIndex=j;\r\n          }\r\n        }else{\r\n          maxValue=data[j];\r\n          minValue=data[j];\r\n          maxIndex=j;\r\n          minIndex=j;\r\n          isMaxSelected=true;\r\n        }\r\n        if(selectIndex==j){\r\n          //找到抽取索引值\r\n          targetData[targetCout]=[maxValue,minValue];\r\n          dataIndex[targetCout]=[maxIndex,minIndex];\r\n          targetCout++;\r\n          isMaxSelected=false;\r\n          selectIndex=this.selectDataIndex(dataLen,targetCout,targetLen)\r\n        }\r\n      }\r\n      return {\r\n        targetData,\r\n        dataIndex\r\n      }\r\n  }\r\n  //监听事件\r\n  /**\r\n   * 鼠标按下事件\r\n   * @param {*} event \r\n   */\r\n  mousedown(event) {\r\n    this.mousedownInfo={\r\n      isMouseDown:true,\r\n      startX:event.offsetX,\r\n      startY:event.offsetY,\r\n      mouseupx:0,\r\n      mouseupy:0,\r\n      button:event.button\r\n    }\r\n    if (event.button === 0) { // 左键\r\n        // isDragging = true;\r\n        // startY = event.clientY;\r\n        this.ctx.canvas.style.cursor = 'grabbing';\r\n    } else if (event.button === 2) { // 右键\r\n        this.ctx.canvas.style.cursor = 'grab';\r\n    }\r\n  }\r\n  /**\r\n   * 鼠标松开事件\r\n   * @param {*} event\r\n   */\r\n  mouseup(event) {\r\n    \r\n    let mousedowinfo={\r\n      isMouseDown:false,\r\n      mouseupx:event.offsetX,\r\n      mouseupy:event.offsetY,\r\n      button:event.button\r\n    }\r\n    this.mousedownInfo={\r\n      ...this.mousedownInfo,\r\n      ...mousedowinfo\r\n    }\r\n    this.ctx.canvas.style.cursor = 'default';\r\n  }\r\n  /**\r\n   * 鼠标移动\r\n   * @param {*} event \r\n   */\r\n  mousemove(event) {\r\n    let x = event.offsetX;\r\n    let y = event.offsetY;\r\n    if (this.mousedownInfo.isMouseDown) {\r\n      if(this.moveInfo.preX==0){\r\n        this.moveInfo.preX = this.mousedownInfo.startX;\r\n        this.moveInfo.preY = this.mousedownInfo.startY;\r\n      }\r\n      const moveX = event.offsetX - this.moveInfo.preX;\r\n      const moveY = this.moveInfo.preY-event.offsetY;\r\n      const moveDirX = event.offsetX - this.mousedownInfo.startX;\r\n      const moveDirY = event.offsetY - this.mousedownInfo.startY;\r\n      let moveDir = \"horizontally\";\r\n      // 判断移动方向\r\n      if (Math.abs(moveDirX) > Math.abs(moveDirY)) {\r\n          moveDir = \"horizontally\";\r\n          let mouseVal=this.getMouseVal(event);\r\n          let order=mouseVal.order;\r\n          if(order==null){\r\n            //全部水平移动\r\n          }else{\r\n            let labelInfo=this.xLabelGridInfo[order];\r\n            let moveVal=Math.ceil(Math.abs(labelInfo.show_end_freq-labelInfo.show_start_freq)/labelInfo.width*moveX)\r\n            if(moveVal==0){moveVal=Math.sign(moveY)}\r\n            let minval=labelInfo.show_start_freq-moveVal\r\n            let maxval=labelInfo.show_end_freq-moveVal\r\n            if(minval>=labelInfo.start_freq&&maxval<=labelInfo.end_freq){\r\n              this.xLabelGridInfo[order].show_start_freq=minval\r\n              this.xLabelGridInfo[order].show_end_freq=maxval\r\n              let newCenter=minval+Math.floor((maxval-minval)/2);\r\n              this.xLabelGridInfo[order].draw_zoom_freq =newCenter;\r\n              this.drawChart();\r\n            }\r\n          }\r\n          \r\n      } else {\r\n          moveDir = \"vertically\";\r\n          let moveVal=Math.ceil(Math.abs(this.options.yaxis.max_value-this.options.yaxis.min_value)/this.chartHeight*moveY)\r\n          if(moveVal==0){moveVal=Math.sign(moveY)}\r\n          let minval=this.options.yaxis.min_value-moveVal\r\n          let maxval=this.options.yaxis.max_value-moveVal\r\n          \r\n          if(minval>=this.options.yaxis.floor_value&&maxval<=this.options.yaxis.ceiling_value){\r\n            this.options.yaxis.min_value=minval\r\n            this.options.yaxis.max_value=maxval\r\n            console.log(\"移动更改y值\",this.options.yaxis.max_value,this.options.yaxis.min_value)\r\n            this.drawChart();\r\n          }\r\n      }\r\n      // 鼠标按下移动\r\n      if (this.mousedownInfo.button === 0) { // 左键\r\n        \r\n      } else if (this.mousedownInfo.button === 2) { // 右键\r\n        \r\n      }\r\n    }else{\r\n      // 鼠标移动\r\n      let type=this.getMousePosition()\r\n      if(type==\"grid\"){\r\n        let point=this.getMousePoint(event);\r\n        //设置鼠标移动坐标\r\n        this.options.level_tipline.point=point;\r\n        this.drawChart();\r\n      }else{\r\n        if(this.options.level_tipline.is_draw){\r\n          this.options.level_tipline.point.pointx=null;\r\n          this.options.level_tipline.is_draw=false;\r\n        }\r\n        \r\n      }\r\n      \r\n    }\r\n    this.moveInfo={\r\n      isMove:true,\r\n      preX:event.offsetX,\r\n      preY:event.offsetY,\r\n      moveX:event.offsetX,\r\n      moveY:event.offsetY\r\n    }\r\n  }\r\n  /**\r\n   * 鼠标移出控件\r\n   * @param {*} event \r\n   */\r\n  mouseout(event){\r\n    event.preventDefault();\r\n    this.mousedownInfo.isMouseDown=false\r\n    this.moveInfo={\r\n      isMove:false,\r\n      preX:0,\r\n      preY:0,\r\n      moveX:0,\r\n      moveY:0\r\n    }\r\n  }\r\n  /**\r\n   * 鼠标滚轮事件\r\n   * @param {*} event\r\n   * \r\n   */\r\n  handleWheel(event) {\r\n    event.preventDefault(); // 阻止默认滚动行为\r\n    const delta = event.deltaY < 0 ? 1 : -1; //下滚缩小，上滚放大\r\n    //const delta = Math.sign(event.deltaY);\r\n    this.throttle(()=>{\r\n      console.log(\"执行频谱节流\")\r\n      this.handleZoom(event,delta);\r\n    })\r\n    \r\n  }\r\n  throttle(callback){\r\n    const now=Date.now();\r\n    if(now-this.lastCallTime>=this.throttleDelay){\r\n      this.lastCallTime=now;\r\n      callback()\r\n    }\r\n  }\r\n  /**\r\n   * 双击事件\r\n   * @param {*} event \r\n   */\r\n  handleDblClick(event) {\r\n    console.log(\"handleDblClick\", event);\r\n  }\r\n  /**\r\n   * 点击事件\r\n   * @param {*} event \r\n   */\r\n  handleClick(event) {\r\n    console.log(\"handleClick\", event);\r\n    let points=this.getMousePosition(event)\r\n    console.log(\"points\",points);\r\n  }\r\n  /*\r\n   * 鼠标右键事件\r\n   * @param {*} event\r\n   */\r\n  handleContextMenu(event) {\r\n    console.log(\"handleContextMenu\", event);\r\n  }\r\n  /**\r\n   * 按键按下事件\r\n   * @param {*} event\r\n   */\r\n  handleKeydown(event) {\r\n    //console.log(\"handleKeydown\", event);\r\n    switch (event.keyCode) {\r\n      case 37: // 左箭头\r\n        console.log(\"左箭头\");\r\n        break;\r\n      case 38: // 上箭头\r\n        console.log(\"上箭头\");\r\n        this.changeThreshold(+0.5)\r\n        break;\r\n      case 39: // 右箭头\r\n        console.log(\"右箭头\");\r\n        break;\r\n      case 40: // 下箭头\r\n        this.changeThreshold(-0.5)\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  /**\r\n   * 按键松开事件\r\n   * @param {*} event \r\n   */\r\n  handleKeyup(event) {\r\n    console.log(\"handleKeyup按键松开事件\", event);\r\n    switch (event.keyCode) {\r\n      case 37: // 左箭头\r\n        console.log(\"左箭头松开\");\r\n        break;\r\n      case 38: // 上箭头\r\n        console.log(\"上箭头松开\");\r\n        this.options.threshold.is_mouse=false;\r\n        break;\r\n      case 39: // 右箭头\r\n        console.log(\"右箭头松开\");\r\n        break;\r\n      case 40: // 下箭头\r\n        console.log(\"下箭头松开\");\r\n        this.options.threshold.is_mouse=false;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  /**\r\n   * 门限图标鼠标按下事件\r\n   * @param {*} event \r\n   */\r\n  thresholdMousedown(event) {\r\n      this.focusType=\"threshold\";\r\n      this.thresholdFouce=true;\r\n      \r\n  }\r\n  /**\r\n   * 门限拖动事件\r\n   * @param {*} event \r\n   */\r\n  thresholdMousemove(event) {\r\n      if(this.thresholdFouce){\r\n        const leves=this.getMouseVal(event,2).y;\r\n        this.options.threshold.level=leves;\r\n        //this.drawThreshold();\r\n        this.drawChart();\r\n      }\r\n      \r\n  }\r\n  /**\r\n   * 门限拖动结束事件\r\n   * @param {*} event \r\n   */\r\n  thresholdMouseout(event) {\r\n      //this.focusType=\"\";\r\n      this.thresholdFouce=false;\r\n      \r\n  }\r\n  /*\r\n  *显示强度提示框\r\n  */\r\n  tipFreqLevel(data){\r\n    if(this.options.level_tipline.is_draw){\r\n      this.fretipDiv.style.display=\"block\";\r\n      // if(data.pointx>this.chartWidth/6*5){\r\n      //   this.fretipDiv.style.right=`${this.width-data.pointx+20}px`;\r\n      //   this.fretipDiv.style.left=``;\r\n      // }else{\r\n      //   this.fretipDiv.style.right=``;\r\n      //   this.fretipDiv.style.left=`${data.pointx+10}px`;\r\n      // }\r\n      if(data.pointx - this.options.grid.left > this.chartWidth/2){\r\n        this.fretipDiv.style.left=``;\r\n        this.fretipDiv.style.right=`${this.width-data.pointx+10}px`;\r\n      }else{\r\n        this.fretipDiv.style.right=``;\r\n        this.fretipDiv.style.left=`${data.pointx+10}px`;\r\n      }\r\n      this.fretipDiv.style.top=`${this.options.grid.top+40}px`;\r\n      let levels=Math.max(...data.y)\r\n      const centtext=this.options.yaxis.axis_function(levels)\r\n      if(this.options.level_tipline.freq_visible){\r\n        this.fretipDiv.innerText=`强度：${centtext}${this.options.yaxis.unit} \\n频率：${data.x/1000000} MHz`\r\n      }else{\r\n        this.fretipDiv.innerText=`强度：${centtext}${this.options.yaxis.unit}`\r\n      }\r\n      //this.fretipDiv.innerText=`强度：${centtext}${this.options.yaxis.unit} 频率：${data.x} MHz`\r\n    }else{\r\n      this.fretipDiv.style.display=\"none\";\r\n    }\r\n  }\r\n  /**\r\n   * 单频设置中心频率和显宽\r\n   * @param {*} centerFre \r\n   * @param {*} span \r\n   */\r\n  setFFTCenterFreAndSpan(centerFre, span) {\r\n    this.options.center_freq = centerFre;\r\n    this.options.span = span;\r\n  }\r\n  /**\r\n   * 单频\r\n   * @returns 获取中心频率和显宽\r\n   */\r\n  getFFTCenterFreAndSpan(){\r\n    return {\r\n      center_freq:this.options.center_freq,\r\n      span:this.options.span\r\n    }\r\n  }\r\n  /**\r\n   * 窗口大小改变事件\r\n   */\r\n  resizeCanvas() {\r\n    this.setCanvasSize(); // 重新设置 Canvas 尺寸\r\n    this.draw(); // 重新绘制图表以适应新尺寸\r\n  }\r\n  /**\r\n   * 设置图表大小\r\n   * @param {*} widhts 宽度\r\n   *  @param {*} heights 高度\r\n   */\r\n  setChartSize(widths, heights){\r\n    if(widths&&heights){\r\n      this.options.width=widths\r\n      this.options.height=heights\r\n    }\r\n    this.setCanvasSize(widths, heights)\r\n    this.draw(); // 重新绘制图表以适应新尺寸\r\n  }\r\n  /**\r\n   * 修改门限值\r\n   * @param {*} num\r\n   */\r\n  changeThreshold(num){\r\n    if(this.options.threshold.visible){\r\n      let newLevel = this.options.threshold.level+num;\r\n      this.options.threshold.is_mouse=true;\r\n      if(newLevel<=this.options.yaxis.max_value&&newLevel>=this.options.yaxis.min_value){\r\n        this.options.threshold.level = newLevel;\r\n        \r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 设置门限值\r\n   * @param {*} level \r\n   */\r\n  setThresholdLevel(level){\r\n    this.options.threshold.level=level;\r\n  }\r\n  /**\r\n   * 获取门限值\r\n   * @returns 门限值\r\n   */\r\n  getThresholdLevel(){\r\n    return this.options.threshold.level;\r\n  }\r\n  /**\r\n   * 门限是否显示\r\n   * @param {*} isShow \r\n   */\r\n  setThresholdShow(isShow){\r\n    this.options.threshold.visible=isShow;\r\n  }\r\n  /**\r\n   * 设置门限属性\r\n   * @param {*} options\r\n   */\r\n  setThresholdAttribute(options){\r\n    let oldattr = deepMerge({},this.options.threshold);\r\n    this.options.threshold = deepMerge(oldattr,options);\r\n  }\r\n  /**\r\n   * 缩放事件\r\n   * @param {*} event \r\n   * @param {*} types \r\n   * @param {*} delta \r\n   * @returns \r\n   */\r\n  handleZoom(event,delta) {\r\n    let type=this.getMousePosition()\r\n    //console.log(\"handleZoom\",event, delta,type);\r\n    const zoomFactor = 1.1;// 缩放因子\r\n    \r\n    if(type==\"left\"){\r\n      let newZoom = this.yZoom+delta;\r\n      let maxZoom = this.options.yaxis.fixedStep;\r\n      let initMaxStep = (this.options.yaxis.ceiling_value-this.options.yaxis.floor_value)/(this.options.yaxis.number-1)\r\n      if(newZoom<1){\r\n        newZoom=1\r\n        return false;\r\n      }\r\n      if(newZoom>initMaxStep){\r\n        newZoom=initMaxStep\r\n      }\r\n      let stepVal=Math.round(initMaxStep/newZoom)\r\n      \r\n      if(stepVal<1){\r\n        console.log(\"步进小于1\")\r\n        return false;\r\n      }\r\n      let nowCout=stepVal*(this.options.yaxis.number-1);\r\n      let mouseVal=this.getMouseVal(event,0).y;\r\n      let minValue=Math.round(mouseVal-(mouseVal-this.options.yaxis.min_value)/(this.options.yaxis.max_value-this.options.yaxis.min_value)*nowCout)\r\n      let maxValue=Math.floor(minValue+nowCout);\r\n      if(minValue<this.options.yaxis.floor_value){\r\n        minValue=this.options.yaxis.floor_value;\r\n        maxValue=minValue+nowCout;\r\n      }\r\n      if(maxValue>this.options.yaxis.ceiling_value){\r\n        maxValue=this.options.yaxis.ceiling_value;\r\n        minValue=maxValue-nowCout;\r\n      }\r\n      console.log(\"y轴计算范围\",maxValue,minValue,newZoom)\r\n      if(minValue>=this.options.yaxis.floor_value&&maxValue<=this.options.yaxis.ceiling_value&&maxValue-minValue>=(this.options.yaxis.number-1)){\r\n          this.options.yaxis.min_value=minValue;\r\n          this.options.yaxis.max_value=maxValue;\r\n          this.yZoom=newZoom;\r\n          console.log(\"y轴缩放步进值\",stepVal,this.options.yaxis.number-1,minValue,maxValue)\r\n          console.log(\"y轴缩放范围\",this.options.yaxis.max_value,this.options.yaxis.min_value,newZoom)\r\n      }\r\n     }else if(type==\"bottom\"){\r\n      //x轴缩放计算\r\n      let mouseVal=this.getMouseVal(event,0);\r\n      if(mouseVal.order!==null){\r\n        let order=mouseVal.order;\r\n        let labelInfo=this.xLabelGridInfo[order];\r\n        let initSpan=labelInfo.span;\r\n        let newZoom=labelInfo.draw_zoom+delta*2**2;\r\n        let zoomSpan = Math.floor(initSpan /newZoom/2)*2;\r\n        if(zoomSpan>initSpan){\r\n          return false;\r\n        }else if (zoomSpan < 6) {\r\n          return false;\r\n        }\r\n        let centerVal=mouseVal.x;\r\n        let minValue=Math.floor(centerVal-(centerVal-labelInfo.show_start_freq)/(labelInfo.show_end_freq-labelInfo.show_start_freq)*zoomSpan)\r\n        let maxValue=Math.floor(minValue+zoomSpan);\r\n        if(minValue<labelInfo.start_freq){\r\n          console.log(\"处理超过最小值\",minValue)\r\n          minValue=labelInfo.start_freq;\r\n          maxValue=Math.floor(minValue+zoomSpan);\r\n        }\r\n        if(maxValue>labelInfo.end_freq){\r\n          console.log(\"处理超过最大值\",maxValue)\r\n          \r\n          maxValue=labelInfo.end_freq;\r\n          minValue=Math.ceil(maxValue-zoomSpan);\r\n        }\r\n        if(minValue>=labelInfo.start_freq&&maxValue<=labelInfo.end_freq){\r\n          this.xLabelGridInfo[order].draw_zoom = newZoom;\r\n          let newCenter=minValue+Math.floor((maxValue-minValue)/2);\r\n          this.xLabelGridInfo[order].draw_zoom_freq =newCenter;\r\n          console.log(\"bottom newZoom 缩放中心频率\",newCenter,newZoom,\"显宽\",zoomSpan)\r\n        }\r\n        \r\n      }\r\n      \r\n    }\r\n    \r\n    this.drawChart();\r\n  }\r\n  /**\r\n   * 获取鼠标位置对应的值\r\n   * @param {*} event \r\n   * @returns \r\n   */\r\n  getMouseVal(event,digit=0){\r\n    // let pointx = event.offsetX;\r\n    // let pointy = event.offsetY;\r\n    const rect = this.canvas.getBoundingClientRect(); // 获取 Canvas 的位置和大小\r\n    let pointx = event.clientX - rect.left; // 计算鼠标相对于 Canvas 的 X 坐标\r\n    let pointy = event.clientY - rect.top; // 计算鼠标相对于 Canvas 的 Y 坐标\r\n    let x=null;//x轴频率\r\n    let y=null;//y轴频率\r\n    let order =null;//x轴标签组序号\r\n    if(pointy<this.options.grid.top){\r\n      y=this.options.yaxis.max_value;\r\n    }else if(pointy>this.height-this.options.grid.bottom){\r\n      y=this.options.yaxis.min_value;\r\n    }else{\r\n      y=this.options.yaxis.max_value-(pointy-this.options.grid.top)/this.chartHeight*(this.options.yaxis.max_value-this.options.yaxis.min_value);\r\n    }\r\n\r\n    if(pointx<this.options.grid.left){\r\n      x=this.xLabelGridInfo[0].show_start_freq;\r\n      order=0\r\n    }else{\r\n      pointx=pointx-this.options.grid.left;\r\n      for(let i=0;i<this.xLabelGridInfo.length;i++){\r\n        if(pointx>=this.xLabelGridInfo[i].start_x&&pointx<=this.xLabelGridInfo[i].end_x){\r\n          x=this.xLabelGridInfo[i].show_start_freq+(pointx-this.xLabelGridInfo[i].start_x)/this.xLabelGridInfo[i].width*(this.xLabelGridInfo[i].show_end_freq-this.xLabelGridInfo[i].show_start_freq);\r\n          x=Math.floor(x)\r\n          order=i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if(digit==0){\r\n      y=Math.floor(y);\r\n    }else{\r\n      y=y.toFixed(digit)*1;\r\n    }\r\n    return {x,y,order};\r\n  }\r\n  /**\r\n   * 获取当前鼠标所在位置频率和强度\r\n   * @param {*} event \r\n   */\r\n  getMousePoint(event,digit=0){\r\n    const rect = this.canvas.getBoundingClientRect(); // 获取 Canvas 的位置和大小\r\n    let pointx = event.clientX - rect.left; // 计算鼠标相对于 Canvas 的 X 坐标\r\n    let pointy = event.clientY - rect.top; // 计算鼠标相对于 Canvas 的 Y 坐标\r\n    return{pointx,pointy}\r\n  }\r\n  /**\r\n   * 获取鼠标当前强度\r\n   * @param {*} data 点坐标\r\n   * @returns \r\n   */\r\n  getMousePositionLevel(data){\r\n    let pointx=data.pointx\r\n    let pointy=data.pointy\r\n    let x=null;//x轴频率\r\n    let xorder =null;//x轴线数据序号\r\n    let y=[];//y轴强度\r\n    let order =null;//x轴段序号\r\n    if(pointx<this.options.grid.left||pointx>this.options.grid.left+this.chartWidth){\r\n      return {x,y,xorder,order,pointx,pointy};\r\n    }else{\r\n      let diff_x=pointx-this.options.grid.left;\r\n      for(let i=0;i<this.xLabelGridInfo.length;i++){\r\n        if(diff_x>=this.xLabelGridInfo[i].start_x&&diff_x<=this.xLabelGridInfo[i].end_x){\r\n          if(this.xLabelGridInfo[i].lineType==\"step\"){\r\n            diff_x=diff_x-this.xLabelGridInfo[i].drawStepPx/2\r\n            if(diff_x<0){\r\n              diff_x=0;\r\n            }\r\n          }\r\n          x=this.xLabelGridInfo[i].show_start_freq+(diff_x-this.xLabelGridInfo[i].start_x)/this.xLabelGridInfo[i].width*(this.xLabelGridInfo[i].show_end_freq-this.xLabelGridInfo[i].show_start_freq);\r\n          x=Math.floor(x)\r\n          order=i;\r\n          if(this.tracesData[0].datainfo[i]==undefined||this.tracesData[0].datainfo[i]==null){\r\n            y=[]\r\n            break;\r\n          }\r\n          xorder=Math.round((x-this.xLabelGridInfo[i].start_freq)/(this.xLabelGridInfo[i].end_freq-this.xLabelGridInfo[i].start_freq)*(this.tracesData[0].datainfo[i].data.length-1));\r\n          if(xorder!==undefined&&xorder!==null){\r\n            for (let j = 0; j < this.tracesData.length; j++) {\r\n                let linedata=this.tracesData[j].datainfo[order].data\r\n                y.push(linedata[xorder]);\r\n            }\r\n          }else{\r\n            y=[]\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      return {x,y,xorder,order,pointx,pointy};\r\n    }\r\n  }\r\n  /**\r\n   * 获取鼠标当前区域\r\n   * @param {*} event \r\n   * @returns \r\n   */\r\n  getMousePosition(events) {\r\n    var event = window.event;\r\n    const rect = this.canvas.getBoundingClientRect(); // 获取 Canvas 的位置和大小\r\n    const x = event.clientX - rect.left; // 计算鼠标相对于 Canvas 的 X 坐标\r\n    const y = event.clientY - rect.top; // 计算鼠标相对于 Canvas 的 Y 坐标\r\n    var result=\"\"\r\n    // 检查鼠标是否在 Canvas 内部\r\n    if (x < 0 || x > this.width || y < 0 || y > this.height) {\r\n        result=null;\r\n    }else if (x < this.options.grid.left) {\r\n        result=\"left\";\r\n    } else if (y < this.options.grid.top) {\r\n        result=\"top\";\r\n    } else if (x > this.canvas.width - this.options.grid.right) {\r\n        result=\"right\";\r\n    } else if (y > this.canvas.height - this.options.grid.bottom) {\r\n        result=\"bottom\";\r\n    } else {\r\n        result=\"grid\";\r\n    }\r\n    this.focusType=result;\r\n    return result;\r\n  }\r\n  /**\r\n   * 获取配置\r\n   */\r\n  getOptions(){\r\n    return this.options;\r\n  }\r\n  /**\r\n   * 设置配置项\r\n   * @param {*} options \r\n   */\r\n  setOptions(options){\r\n    let newoptions = deepMerge(this.options,options);\r\n    this.initOptions(newoptions);\r\n  }\r\n}\r\n\r\n\r\n// Compatibility for ES5 environments\r\n// if (typeof module !== 'undefined' && module.exports) {\r\n//   module.exports = sptmChart;\r\n// }\r\n\r\nexport default sptmChart;"],"names":["deepMerge","target","source","key","hasOwnProperty","_typeof","Array","isArray","truncateNumber","num","decimalPlaces","isnum","arguments","length","undefined","isNaN","Error","Math","max","floor","factor","pow","truncated","trunc","parseFloat","toFixed","sptmChart","id","options","_this","this","_classCallCheck","devicePixelRatio","window","loadOptions","box","document","getElementById","style","position","innerHTML","canvas","createElement","appendChild","ctx","getContext","imageSmoothingEnabled","initOptions","setCanvasSize","refreshInterval","isDraw","thresholdDiv","thresholdFouce","fretipDiv","chartWidth","chartHeight","ygridStep","yZoom","tracesData","focusType","throttleDelay","lastCallTime","wheelListener","handleWheel","bind","init","addEventListener","mousedown","mouseup","mousemove","mouseout","handleDblClick","handleClick","handleContextMenu","handleKeydown","handleKeyup","resizeCanvas","mousedownInfo","isMouseDown","startX","startY","mouseupx","mouseupy","button","moveInfo","isMove","preX","preY","moveX","moveY","initthreshold","initFredTip","value","widths","heights","width","height","containerWidth","clientWidth","containerHeight","clientHeight","concat","mergedOptions","type","duration","background","center_freq","span","is_drag_zoom","grid","left","top","bottom","right","color","xgrid_show","xgrid_line_dash","ygrid_show","ygrid_line_dash","center_line_show","center_color","center_width","legend","visible","xaxis","number","unit","unit_two_line","unit_right","decimals","dscan_freq","dscan_space","text_color","text_font_size","text_font_family","labels","offsetx","text","label_two_line","label_angle","draw_zoom_freq","draw_zoom_span","yaxis","fixedStep","init_min_value","init_max_value","min_value","max_value","floor_value","ceiling_value","axis_function","zoom_value","marker","tip_show","freqdiff_show","is_add","focus_color","focus_width","border_radius","difftext_color","difftext_font_size","difftext_font_family","diff_background","diff_border_radius","threshold","is_darg","is_mouse","level","drag_color","drag_width","drag_text_color","drag_text_font_size","icon_url","drag_icon_url","icon_size","sptm_area","drag_background","start_freq","end_freq","level_tipline","freq_visible","is_draw","point","pointx","pointy","yLabelGridInfo","xLabelGridInfo","clearCanvas","initBackground","drawAxis","drawGrid","className","backgroundImage","backgroundSize","iconLeft","display","parentNode","thresholdMousedown","thresholdMousemove","thresholdMouseout","freqTip","fontSize","text_size","clearRect","fillStyle","fillRect","_this2","cumputeLabels","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","textBaseline","font","forEach","data","index","j","items","texts","angleInRadians","PI","x","y","textAlign","fillText","save","translate","rotate","restore","halfWidth","measureText","label","offsetY","_this3","_this$options","legendItems","map","name","totalLegendWidth","reduce","sum","item","legendX","legendY","currentX","_this4","setLineDash","indexs","colors","gridLength","gridLabels","pxStep","drawLegend","drawTraces","drawOther","_this5","clearInterval","setInterval","draw","widhts","cursor","labeltext","textwidth","iconTop","mouselevel","getMousePositionLevel","tipFreqLevel","drawThreshold","drawTipLine","i","datainfo","linedata","drawTypeLine","lineData","order","drawData","slice","labelInfo","drawWidth","show_start_freq","show_end_freq","startOrder","endOrder","pointdata","lineType","extractTwoPolesTraceLine","drawLine","rect","clip","targetData","drawStepPx","startPointPx","start_x","startx","x1","x2","minpoint","y1","option","push","drawChart","dataInfo","yStepLabels","minValue","maxValues","zooms","stepStart","stepEnd","labelnum","zoom","stepValue","round","labelStep","maxValue","gridstepValue","minDiff","calculateStepValues","xCoutWidth","drawArray","itemdata","widthVal","minSpacing","totalWidth","numberOfSegments","totalDemand","a","b","totalSpacing","minWidth","minWidthNum","filter","w","finalWidths","assignedWidth","assignedSpacing","remainingWidth","countOfOnes","increasePerOne","extraWidthPerSegment","widthDecrease","ceil","min","apply","_toConsumableArray","spacing","sumCout","calculateWidths","datastartFreq","dataendFreq","dataspan","centerFreq","drawInfo","draw_zoom","xspan","startFreq","endFreq","labelCout","freqStep","labelStepPx","labelObj","end_x","yVal","dataLen","targetIndex","targetLen","dataIndex","selectIndex","targetCout","selectDataIndex","isMaxSelected","maxIndex","minIndex","event","offsetX","mousedowinfo","_objectSpread","moveDirX","moveDirY","abs","getMouseVal","moveVal","sign","minval","maxval","newCenter","getMousePosition","getMousePoint","preventDefault","_this6","delta","deltaY","throttle","handleZoom","callback","now","Date","keyCode","changeThreshold","leves","levels","centtext","innerText","centerFre","newLevel","isShow","oldattr","newZoom","initMaxStep","stepVal","nowCout","mouseVal","initSpan","zoomSpan","centerVal","digit","getBoundingClientRect","clientX","clientY","xorder","diff_x","events","result","newoptions"],"mappings":"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"}